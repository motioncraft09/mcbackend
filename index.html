<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motioncraft Management System</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f5f7fa;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --accent: #4299e1;
            --accent-light: #bee3f8;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --success: #48bb78;
            --warning: #ed8936;
            --danger: #f56565;
        }

        .dark-mode {
            --bg-primary: #1a202c;
            --bg-secondary: #2d3748;
            --bg-card: #2d3748;
            --text-primary: #f7fafc;
            --text-secondary: #cbd5e0;
            --accent: #63b3ed;
            --accent-light: #2c5282;
            --border: #4a5568;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--bg-secondary);
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--accent), #9f7aea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--accent), #9f7aea);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: none;
            width: 50px;
            height: 26px;
            border-radius: 50px;
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 0 3px;
            box-shadow: var(--shadow);
        }

        .theme-toggle::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent);
            transition: transform 0.3s;
        }

        .dark-mode .theme-toggle::after {
            transform: translateX(24px);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background-color: var(--bg-secondary);
            padding: 10px;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .tab {
            padding: 12px 24px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            background-color: var(--accent);
            color: white;
        }

        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .card-title {
            font-size: 20px;
            font-weight: 600;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: var(--accent);
            color: white;
        }

        .btn-secondary {
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 14px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--bg-card);
        }

        th, td {
            padding: 16px;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            font-weight: 600;
            color: var(--text-secondary);
            background-color: var(--bg-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: var(--bg-secondary);
        }

        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .status-fresh {
            background-color: var(--accent-light);
            color: var(--accent);
        }

        .status-scripting {
            background-color: #fef5e7;
            color: #d69e2e;
        }

        .status-editing {
            background-color: #e6fffa;
            color: #319795;
        }

        .status-correction {
            background-color: #fff5f5;
            color: #e53e3e;
        }

        .status-final {
            background-color: #f0fff4;
            color: #38a169;
        }

        .payment-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .payment-pending {
            background-color: #fef5e7;
            color: #d69e2e;
        }

        .payment-paid {
            background-color: #f0fff4;
            color: #38a169;
        }

        .whatsapp-link {
            color: #25D366;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select, .search-input {
            padding: 10px 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background-color: var(--bg-card);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }

        .search-input {
            flex-grow: 1;
            min-width: 200px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--bg-card);
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border-radius: 12px;
            border: 1px solid var(--border);
            background-color: var(--bg-card);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .currency-display {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .currency-symbol {
            font-weight: 600;
        }

        .setup-section {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 24px;
            box-shadow: var(--shadow);
            margin-bottom: 24px;
            border-left: 5px solid var(--accent);
        }

        .setup-step {
            margin-bottom: 20px;
            padding-left: 20px;
            border-left: 3px solid var(--accent-light);
        }

        .setup-step h4 {
            margin-bottom: 10px;
            color: var(--accent);
        }

        .realtime-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            padding: 10px;
            border-radius: 10px;
            background-color: var(--bg-primary);
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--success);
            animation: pulse 2s infinite;
        }

        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            background-color: var(--bg-card);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid var(--accent);
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 14px;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 18px;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @media (max-width: 768px) {
            .filter-bar {
                flex-direction: column;
            }
            
            .search-input {
                min-width: auto;
            }
            
            .header-controls {
                flex-direction: column;
                gap: 10px;
            }
            
            .modal-content {
                padding: 20px;
                margin: 10px;
            }
            
            .modal-footer {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">M</div>
                <h1>Motioncraft Management System</h1>
            </div>
            <div class="header-controls">
                <div class="realtime-status">
                    <div class="status-indicator"></div>
                    <span>Real-Time Active</span>
                </div>
                <button class="theme-toggle" id="themeToggle"></button>
            </div>
        </header>

        <div class="setup-section">
            <h3>Multi-Device System</h3>
            <p>This system works across multiple devices using cloud storage.</p>
            
            <div class="setup-step">
                <h4>How It Works</h4>
                <p>All data is synchronized using cloud storage. Make sure you're using the same account on all devices.</p>
            </div>
            
            <div class="setup-step">
                <h4>Data Management</h4>
                <p>You can download or upload your data for backup purposes.</p>
                <button class="btn btn-secondary" id="downloadDataBtn">Download Data Backup</button>
                <input type="file" id="uploadDataInput" accept=".json" style="margin: 10px 0;">
                <button class="btn btn-secondary" id="uploadDataBtn">Upload Data Backup</button>
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" data-tab="orders">Orders</div>
            <div class="tab" data-tab="team">Team</div>
            <div class="tab" data-tab="finance">Finance</div>
            <div class="tab" data-tab="clients">Clients</div>
        </div>

        <!-- Orders Dashboard -->
        <div class="dashboard active" id="ordersDashboard">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Order Management</h2>
                    <button class="btn btn-primary" id="addOrderBtn">
                        <span>+</span> Add New Order
                    </button>
                </div>

                <div class="filter-bar">
                    <select class="filter-select" id="statusFilter">
                        <option value="">All Status</option>
                        <option value="Fresh">Fresh</option>
                        <option value="Scripting">Scripting</option>
                        <option value="Editing">Editing</option>
                        <option value="Correction">Correction</option>
                        <option value="Final Delivery">Final Delivery</option>
                    </select>
                    <select class="filter-select" id="editorFilter">
                        <option value="">All Editors</option>
                        <option value="Siam">Siam</option>
                        <option value="Mojid">Mojid</option>
                        <option value="Samiul">Samiul</option>
                    </select>
                    <select class="filter-select" id="timeFilter">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                    </select>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search orders...">
                    <button class="btn btn-secondary" id="exportCsvBtn">Export CSV</button>
                </div>

                <div class="table-container">
                    <table id="ordersTable">
                        <thead>
                            <tr>
                                <th>Client</th>
                                <th>Project</th>
                                <th>Price</th>
                                <th>Editor Payment</th>
                                <th>Payment Status</th>
                                <th>WhatsApp</th>
                                <th>Editor</th>
                                <th>Status</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                            <!-- Orders will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Team Dashboard -->
        <div class="dashboard" id="teamDashboard">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Team Management</h2>
                    <button class="btn btn-primary" id="addTeamMemberBtn">
                        <span>+</span> Add Team Member
                    </button>
                </div>

                <div class="stats-grid" id="teamStatsGrid">
                    <!-- Team stats will be loaded here -->
                </div>

                <div class="table-container">
                    <table id="teamTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>WhatsApp</th>
                                <th>Total Projects</th>
                                <th>This Month</th>
                                <th>Pending</th>
                                <th>Completed</th>
                                <th>Total Earnings</th>
                                <th>Pending Payments</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="teamTableBody">
                            <!-- Team data will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Finance Dashboard -->
        <div class="dashboard" id="financeDashboard">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Financial Overview</h2>
                    <button class="btn btn-primary" id="addExpenseBtn">
                        <span>+</span> Add Expense
                    </button>
                </div>

                <div class="filter-bar">
                    <input type="month" class="filter-select" id="monthPicker" value="">
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-label">Total Income</div>
                        <div class="stat-value" id="totalIncome">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Total Expense</div>
                        <div class="stat-value" id="totalExpense">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Editor Payments</div>
                        <div class="stat-value" id="editorPayments">$0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Profit</div>
                        <div class="stat-value" id="profit">$0</div>
                    </div>
                </div>

                <div class="card" style="margin-top: 24px;">
                    <div class="card-header">
                        <h2 class="card-title">Recent Expenses</h2>
                    </div>
                    <div class="table-container">
                        <table id="expensesTable">
                            <thead>
                                <tr>
                                    <th>Expense Name</th>
                                    <th>Amount</th>
                                    <th>Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="expensesTableBody">
                                <!-- Expenses will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="card" style="margin-top: 24px;">
                    <div class="card-header">
                        <h2 class="card-title">Pending Editor Payments</h2>
                    </div>
                    <div class="table-container">
                        <table id="paymentsTable">
                            <thead>
                                <tr>
                                    <th>Editor</th>
                                    <th>Project</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Due Date</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="paymentsTableBody">
                                <!-- Payments will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Clients Dashboard -->
        <div class="dashboard" id="clientsDashboard">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Client Directory</h2>
                </div>

                <div class="stats-grid" id="clientStatsGrid">
                    <!-- Client stats will be loaded here -->
                </div>

                <div class="table-container">
                    <table id="clientsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>WhatsApp</th>
                                <th>Total Orders</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody id="clientsTableBody">
                            <!-- Clients will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Add/Edit Order Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="orderModalTitle">Add New Order</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="orderForm">
                    <input type="hidden" id="orderId">
                    <div class="form-group">
                        <label class="form-label" for="clientName">Client Name</label>
                        <input type="text" class="form-input" id="clientName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="projectName">Project Name</label>
                        <input type="text" class="form-input" id="projectName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="projectPrice">Project Price</label>
                        <input type="number" class="form-input" id="projectPrice" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="editorPayment">Editor Payment</label>
                        <input type="number" class="form-input" id="editorPayment" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="whatsappNumber">WhatsApp Number</label>
                        <input type="text" class="form-input" id="whatsappNumber" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="assignedEditor">Assigned Editor</label>
                        <select class="form-select" id="assignedEditor" required>
                            <option value="">Select Editor</option>
                            <option value="Siam">Siam</option>
                            <option value="Mojid">Mojid</option>
                            <option value="Samiul">Samiul</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="projectStatus">Project Status</label>
                        <select class="form-select" id="projectStatus" required>
                            <option value="Fresh">Fresh</option>
                            <option value="Scripting">Scripting</option>
                            <option value="Editing">Editing</option>
                            <option value="Correction">Correction</option>
                            <option value="Final Delivery">Final Delivery</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="projectDate">Date</label>
                        <input type="date" class="form-input" id="projectDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="projectNotes">Notes</label>
                        <textarea class="form-textarea" id="projectNotes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveOrderBtn">Save Order</button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Team Member Modal -->
    <div class="modal" id="teamMemberModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="teamMemberModalTitle">Add Team Member</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="teamMemberForm">
                    <input type="hidden" id="teamMemberId">
                    <div class="form-group">
                        <label class="form-label" for="memberName">Name</label>
                        <input type="text" class="form-input" id="memberName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="memberRole">Role</label>
                        <select class="form-select" id="memberRole" required>
                            <option value="">Select Role</option>
                            <option value="Editor">Editor</option>
                            <option value="Script Writer">Script Writer</option>
                            <option value="Project Manager">Project Manager</option>
                            <option value="Designer">Designer</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="memberWhatsApp">WhatsApp Number</label>
                        <input type="text" class="form-input" id="memberWhatsApp" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="memberEmail">Email</label>
                        <input type="email" class="form-input" id="memberEmail">
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="memberJoinDate">Join Date</label>
                        <input type="date" class="form-input" id="memberJoinDate" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="memberStatus">Status</label>
                        <select class="form-select" id="memberStatus" required>
                            <option value="Active">Active</option>
                            <option value="Inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="memberNotes">Notes</label>
                        <textarea class="form-textarea" id="memberNotes"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveTeamMemberBtn">Save Member</button>
            </div>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div class="modal" id="expenseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add Expense</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="expenseForm">
                    <div class="form-group">
                        <label class="form-label" for="expenseName">Expense Name</label>
                        <input type="text" class="form-input" id="expenseName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="expenseAmount">Amount</label>
                        <input type="number" class="form-input" id="expenseAmount" min="0" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" for="expenseDate">Date</label>
                        <input type="date" class="form-input" id="expenseDate" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="submit" class="btn btn-primary" id="saveExpenseBtn">Add Expense</button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let orders = [];
        let expenses = [];
        let teamMembers = [];
        let currentEditingId = null;
        let lastDataHash = '';
        let notificationTimeout = null;

        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const tabs = document.querySelectorAll('.tab');
        const dashboards = document.querySelectorAll('.dashboard');
        const ordersTableBody = document.getElementById('ordersTableBody');
        const teamTableBody = document.getElementById('teamTableBody');
        const clientsTableBody = document.getElementById('clientsTableBody');
        const expensesTableBody = document.getElementById('expensesTableBody');
        const paymentsTableBody = document.getElementById('paymentsTableBody');
        const orderModal = document.getElementById('orderModal');
        const teamMemberModal = document.getElementById('teamMemberModal');
        const expenseModal = document.getElementById('expenseModal');
        const orderForm = document.getElementById('orderForm');
        const teamMemberForm = document.getElementById('teamMemberForm');
        const expenseForm = document.getElementById('expenseForm');
        const addOrderBtn = document.getElementById('addOrderBtn');
        const addTeamMemberBtn = document.getElementById('addTeamMemberBtn');
        const addExpenseBtn = document.getElementById('addExpenseBtn');
        const closeModalBtns = document.querySelectorAll('.close-modal');
        const statusFilter = document.getElementById('statusFilter');
        const editorFilter = document.getElementById('editorFilter');
        const timeFilter = document.getElementById('timeFilter');
        const searchInput = document.getElementById('searchInput');
        const exportCsvBtn = document.getElementById('exportCsvBtn');
        const monthPicker = document.getElementById('monthPicker');
        const totalIncomeEl = document.getElementById('totalIncome');
        const totalExpenseEl = document.getElementById('totalExpense');
        const editorPaymentsEl = document.getElementById('editorPayments');
        const profitEl = document.getElementById('profit');
        const downloadDataBtn = document.getElementById('downloadDataBtn');
        const uploadDataBtn = document.getElementById('uploadDataBtn');
        const uploadDataInput = document.getElementById('uploadDataInput');
        const saveOrderBtn = document.getElementById('saveOrderBtn');
        const saveTeamMemberBtn = document.getElementById('saveTeamMemberBtn');
        const saveExpenseBtn = document.getElementById('saveExpenseBtn');
        const notificationContainer = document.getElementById('notificationContainer');

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        // Initialize the application
        function initApp() {
            // Set current month as default
            const now = new Date();
            monthPicker.value = now.toISOString().slice(0, 7);
            
            // Load sample data if no data exists
            loadFromLocalStorage();
            
            // Set up event listeners
            setupEventListeners();
            
            // Render initial data
            renderOrders();
            renderTeamStats();
            updateFinance();
            renderClients();
            
            // Start real-time simulation
            startRealTimeSimulation();
        }

        // Set up all event listeners
        function setupEventListeners() {
            // Theme toggle
            themeToggle.addEventListener('click', toggleTheme);
            
            // Tab navigation
            tabs.forEach(tab => {
                tab.addEventListener('click', () => switchTab(tab.dataset.tab));
            });
            
            // Modal controls
            addOrderBtn.addEventListener('click', () => openOrderModal());
            addTeamMemberBtn.addEventListener('click', () => openTeamMemberModal());
            addExpenseBtn.addEventListener('click', () => openExpenseModal());
            
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', closeModals);
            });
            
            // Form submissions
            saveOrderBtn.addEventListener('click', handleOrderSubmit);
            saveTeamMemberBtn.addEventListener('click', handleTeamMemberSubmit);
            saveExpenseBtn.addEventListener('click', handleExpenseSubmit);
            
            // Filters and search
            statusFilter.addEventListener('change', filterOrders);
            editorFilter.addEventListener('change', filterOrders);
            timeFilter.addEventListener('change', filterOrders);
            searchInput.addEventListener('input', filterOrders);
            monthPicker.addEventListener('change', updateFinance);
            
            // Export CSV
            exportCsvBtn.addEventListener('click', exportOrdersToCSV);
            
            // Data management
            downloadDataBtn.addEventListener('click', downloadData);
            uploadDataBtn.addEventListener('click', uploadData);
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === orderModal) closeModals();
                if (e.target === teamMemberModal) closeModals();
                if (e.target === expenseModal) closeModals();
            });
        }

        // Show notification
        function showNotification(title, message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            let icon = '‚ÑπÔ∏è';
            if (type === 'success') icon = '‚úÖ';
            if (type === 'warning') icon = '‚ö†Ô∏è';
            if (type === 'error') icon = '‚ùå';
            
            notification.innerHTML = `
                <div class="notification-icon">${icon}</div>
                <div class="notification-content">
                    <div class="notification-title">${title}</div>
                    <div class="notification-message">${message}</div>
                </div>
                <button class="notification-close">&times;</button>
            `;
            
            notificationContainer.appendChild(notification);
            
            // Add event listener to close button
            notification.querySelector('.notification-close').addEventListener('click', () => {
                notification.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Simulate real-time updates
        function startRealTimeSimulation() {
            // In a real implementation, this would connect to a real-time database
            // For this demo, we'll simulate real-time by updating the UI frequently
            setInterval(() => {
                // Update time-sensitive data
                updateFinance();
                
                // Check for changes in localStorage (simulating multi-user)
                checkForExternalUpdates();
            }, 2000);
        }

        // Check for external updates (simulated)
        function checkForExternalUpdates() {
            // In a real implementation, this would check a shared database
            // For this demo, we'll just reload from localStorage
            const savedData = localStorage.getItem('motioncraft_data');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    const currentHash = JSON.stringify(data);
                    
                    // Check if data has changed
                    if (currentHash !== lastDataHash) {
                        // Data has changed, update our state
                        orders = data.orders || [];
                        expenses = data.expenses || [];
                        teamMembers = data.teamMembers || [];
                        
                        // Show notification if this is an external change
                        if (lastDataHash && !notificationTimeout) {
                            showNotification('Data Updated', 'Your manager has made changes to the data.', 'success');
                            notificationTimeout = setTimeout(() => {
                                notificationTimeout = null;
                            }, 5000);
                        }
                        
                        // Refresh UI
                        renderOrders();
                        renderTeamStats();
                        updateFinance();
                        renderClients();
                        
                        // Update last hash
                        lastDataHash = currentHash;
                    }
                } catch (e) {
                    console.error('Error checking for updates:', e);
                }
            } else {
                // Initialize lastDataHash
                const data = { orders, expenses, teamMembers };
                lastDataHash = JSON.stringify(data);
            }
        }

        // Toggle between light and dark mode
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
        }

        // Switch between dashboard tabs
        function switchTab(tabName) {
            // Update active tab
            tabs.forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });
            
            // Show active dashboard
            dashboards.forEach(dashboard => {
                dashboard.classList.toggle('active', dashboard.id === `${tabName}Dashboard`);
            });
            
            // Refresh data for the active tab
            if (tabName === 'orders') {
                renderOrders();
            } else if (tabName === 'team') {
                renderTeamStats();
            } else if (tabName === 'finance') {
                updateFinance();
            } else if (tabName === 'clients') {
                renderClients();
            }
        }

        // Save data to localStorage
        function saveToLocalStorage() {
            const data = {
                orders: orders,
                expenses: expenses,
                teamMembers: teamMembers,
                lastUpdated: new Date().toISOString()
            };
            localStorage.setItem('motioncraft_data', JSON.stringify(data));
            
            // Update last hash
            lastDataHash = JSON.stringify(data);
        }

        // Load data from localStorage
        function loadFromLocalStorage() {
            const savedData = localStorage.getItem('motioncraft_data');
            const savedTheme = localStorage.getItem('theme');
            
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    orders = data.orders || [];
                    expenses = data.expenses || [];
                    teamMembers = data.teamMembers || [];
                } catch (e) {
                    console.error('Error parsing saved data:', e);
                    // If there's an error, initialize with sample data
                    initializeSampleData();
                }
            } else {
                // If no data exists, initialize with sample data
                initializeSampleData();
            }
            
            if (savedTheme === 'dark') document.body.classList.add('dark-mode');
        }

        // Initialize with sample data
        function initializeSampleData() {
            // Sample orders
            orders = [
                {
                    id: generateId(),
                    clientName: "John Smith",
                    projectName: "Product Explainer Video",
                    projectPrice: 500,
                    editorPayment: 200,
                    paymentStatus: "Pending",
                    whatsappNumber: "1234567890",
                    assignedEditor: "Siam",
                    projectStatus: "Editing",
                    projectDate: new Date().toISOString().slice(0, 10),
                    notes: "Need to focus on product benefits"
                },
                {
                    id: generateId(),
                    clientName: "Sarah Johnson",
                    projectName: "Corporate Training Module",
                    projectPrice: 800,
                    editorPayment: 350,
                    paymentStatus: "Paid",
                    whatsappNumber: "0987654321",
                    assignedEditor: "Mojid",
                    projectStatus: "Final Delivery",
                    projectDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
                    notes: "Client requested minor corrections"
                }
            ];
            
            // Sample team members
            teamMembers = [
                {
                    id: generateId(),
                    name: "Siam",
                    role: "Editor",
                    whatsapp: "1234567890",
                    email: "siam@motioncraft.com",
                    joinDate: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
                    status: "Active",
                    notes: "Specializes in explainer videos"
                },
                {
                    id: generateId(),
                    name: "Mojid",
                    role: "Editor",
                    whatsapp: "0987654321",
                    email: "mojid@motioncraft.com",
                    joinDate: new Date(Date.now() - 120 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
                    status: "Active",
                    notes: "Expert in corporate videos"
                },
                {
                    id: generateId(),
                    name: "Samiul",
                    role: "Script Writer",
                    whatsapp: "1122334455",
                    email: "samiul@motioncraft.com",
                    joinDate: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10),
                    status: "Active",
                    notes: "Creative script development"
                }
            ];
            
            // Sample expenses
            expenses = [
                {
                    id: generateId(),
                    expenseName: "Software Subscription",
                    expenseAmount: 50,
                    expenseDate: new Date().toISOString().slice(0, 10)
                },
                {
                    id: generateId(),
                    expenseName: "Hardware Upgrade",
                    expenseAmount: 300,
                    expenseDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString().slice(0, 10)
                }
            ];
            
            saveToLocalStorage();
        }

        // Render orders table
        function renderOrders(filteredOrders = null) {
            const ordersToRender = filteredOrders || orders;
            
            if (ordersToRender.length === 0) {
                ordersTableBody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <div class="empty-state-icon">üìã</div>
                            <div>No orders found</div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            ordersTableBody.innerHTML = ordersToRender.map(order => `
                <tr>
                    <td>${order.clientName || 'N/A'}</td>
                    <td>${order.projectName || 'N/A'}</td>
                    <td>
                        <div class="currency-display">
                            <span class="currency-symbol">${formatCurrency(order.projectPrice || 0)}</span>
                        </div>
                    </td>
                    <td>
                        <div class="currency-display">
                            <span class="currency-symbol">${formatCurrency(order.editorPayment || 0)}</span>
                        </div>
                    </td>
                    <td>
                        <span class="payment-status ${order.paymentStatus === 'Paid' ? 'payment-paid' : 'payment-pending'}">
                            ${order.paymentStatus || 'Pending'}
                        </span>
                    </td>
                    <td>
                        <a href="https://wa.me/${order.whatsappNumber || ''}?text=Hello Motioncraft" 
                           target="_blank" class="whatsapp-link">
                            üì± Chat
                        </a>
                    </td>
                    <td>${order.assignedEditor || 'N/A'}</td>
                    <td>
                        <span class="status status-${(order.projectStatus || 'Fresh').toLowerCase().replace(' ', '-')}">
                            ${order.projectStatus || 'Fresh'}
                        </span>
                    </td>
                    <td>${formatDate(order.projectDate)}</td>
                    <td>
                        <button class="btn btn-secondary btn-small edit-order" data-id="${order.id}">
                            Edit
                        </button>
                        ${order.paymentStatus !== 'Paid' ? `
                        <button class="btn btn-success btn-small mark-paid" data-id="${order.id}">
                            Mark Paid
                        </button>
                        ` : ''}
                        <button class="btn btn-danger btn-small delete-order" data-id="${order.id}">
                            Delete
                        </button>
                    </td>
                </tr>
            `).join('');
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-order').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const orderId = e.target.dataset.id;
                    openOrderModal(orderId);
                });
            });
            
            document.querySelectorAll('.delete-order').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const orderId = e.target.dataset.id;
                    deleteOrder(orderId);
                });
            });
            
            // Add event listeners to mark paid buttons
            document.querySelectorAll('.mark-paid').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const orderId = e.target.dataset.id;
                    markPaymentAsPaid(orderId);
                });
            });
        }

        // Mark payment as paid
        function markPaymentAsPaid(orderId) {
            if (!confirm('Are you sure you want to mark this payment as paid?')) return;
            
            const index = orders.findIndex(o => o.id === orderId);
            if (index !== -1) {
                orders[index].paymentStatus = 'Paid';
                orders[index].paymentDate = new Date().toISOString().slice(0, 10);
                saveToLocalStorage();
                renderOrders();
                renderTeamStats();
                updateFinance();
                showNotification('Payment Updated', `Payment marked as paid for order: ${orders[index].projectName}`, 'success');
            }
        }

        // Filter orders based on selected criteria
        function filterOrders() {
            const status = statusFilter.value;
            const editor = editorFilter.value;
            const timePeriod = timeFilter.value;
            const searchTerm = searchInput.value.toLowerCase();
            
            let filtered = orders;
            
            // Filter by status
            if (status) {
                filtered = filtered.filter(order => order.projectStatus === status);
            }
            
            // Filter by editor
            if (editor) {
                filtered = filtered.filter(order => order.assignedEditor === editor);
            }
            
            // Filter by time period
            if (timePeriod) {
                const now = new Date();
                let startDate;
                
                if (timePeriod === 'today') {
                    startDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
                } else if (timePeriod === 'week') {
                    const day = now.getDay();
                    const diff = now.getDate() - day + (day === 0 ? -6 : 1);
                    startDate = new Date(now.setDate(diff));
                } else if (timePeriod === 'month') {
                    startDate = new Date(now.getFullYear(), now.getMonth(), 1);
                }
                
                filtered = filtered.filter(order => {
                    const orderDate = new Date(order.projectDate);
                    return orderDate >= startDate;
                });
            }
            
            // Filter by search term
            if (searchTerm) {
                filtered = filtered.filter(order => 
                    (order.clientName || '').toLowerCase().includes(searchTerm) ||
                    (order.projectName || '').toLowerCase().includes(searchTerm)
                );
            }
            
            renderOrders(filtered);
        }

        // Open order modal for adding or editing
        function openOrderModal(orderId = null) {
            const modalTitle = document.getElementById('orderModalTitle');
            
            if (orderId) {
                // Edit mode
                modalTitle.textContent = 'Edit Order';
                currentEditingId = orderId;
                
                const order = orders.find(o => o.id === orderId);
                if (order) {
                    document.getElementById('orderId').value = order.id;
                    document.getElementById('clientName').value = order.clientName || '';
                    document.getElementById('projectName').value = order.projectName || '';
                    document.getElementById('projectPrice').value = order.projectPrice || '';
                    document.getElementById('editorPayment').value = order.editorPayment || '';
                    document.getElementById('whatsappNumber').value = order.whatsappNumber || '';
                    document.getElementById('assignedEditor').value = order.assignedEditor || '';
                    document.getElementById('projectStatus').value = order.projectStatus || 'Fresh';
                    document.getElementById('projectDate').value = order.projectDate || '';
                    document.getElementById('projectNotes').value = order.notes || '';
                }
            } else {
                // Add mode
                modalTitle.textContent = 'Add New Order';
                currentEditingId = null;
                orderForm.reset();
                document.getElementById('projectDate').value = new Date().toISOString().slice(0, 10);
                document.getElementById('projectStatus').value = 'Fresh';
            }
            
            orderModal.classList.add('active');
        }

        // Open team member modal for adding or editing
        function openTeamMemberModal(memberId = null) {
            const modalTitle = document.getElementById('teamMemberModalTitle');
            
            if (memberId) {
                // Edit mode
                modalTitle.textContent = 'Edit Team Member';
                currentEditingId = memberId;
                
                const member = teamMembers.find(m => m.id === memberId);
                if (member) {
                    document.getElementById('teamMemberId').value = member.id;
                    document.getElementById('memberName').value = member.name || '';
                    document.getElementById('memberRole').value = member.role || '';
                    document.getElementById('memberWhatsApp').value = member.whatsapp || '';
                    document.getElementById('memberEmail').value = member.email || '';
                    document.getElementById('memberJoinDate').value = member.joinDate || '';
                    document.getElementById('memberStatus').value = member.status || 'Active';
                    document.getElementById('memberNotes').value = member.notes || '';
                }
            } else {
                // Add mode
                modalTitle.textContent = 'Add Team Member';
                currentEditingId = null;
                teamMemberForm.reset();
                document.getElementById('memberJoinDate').value = new Date().toISOString().slice(0, 10);
                document.getElementById('memberStatus').value = 'Active';
            }
            
            teamMemberModal.classList.add('active');
        }

        // Open expense modal
        function openExpenseModal() {
            expenseForm.reset();
            document.getElementById('expenseDate').value = new Date().toISOString().slice(0, 10);
            expenseModal.classList.add('active');
        }

        // Close all modals
        function closeModals() {
            orderModal.classList.remove('active');
            teamMemberModal.classList.remove('active');
            expenseModal.classList.remove('active');
            currentEditingId = null;
        }

        // Handle order form submission
        function handleOrderSubmit(e) {
            e.preventDefault();
            
            const formData = {
                clientName: document.getElementById('clientName').value,
                projectName: document.getElementById('projectName').value,
                projectPrice: parseFloat(document.getElementById('projectPrice').value).toFixed(2),
                editorPayment: parseFloat(document.getElementById('editorPayment').value).toFixed(2),
                paymentStatus: 'Pending',
                whatsappNumber: document.getElementById('whatsappNumber').value,
                assignedEditor: document.getElementById('assignedEditor').value,
                projectStatus: document.getElementById('projectStatus').value,
                projectDate: document.getElementById('projectDate').value,
                notes: document.getElementById('projectNotes').value
            };
            
            if (currentEditingId) {
                // Update existing order
                updateOrder(currentEditingId, formData);
                showNotification('Order Updated', `Order "${formData.projectName}" has been updated`, 'success');
            } else {
                // Add new order
                formData.id = generateId();
                addOrder(formData);
                showNotification('Order Added', `New order "${formData.projectName}" has been added`, 'success');
            }
            
            closeModals();
        }

        // Handle team member form submission
        function handleTeamMemberSubmit(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('memberName').value,
                role: document.getElementById('memberRole').value,
                whatsapp: document.getElementById('memberWhatsApp').value,
                email: document.getElementById('memberEmail').value,
                joinDate: document.getElementById('memberJoinDate').value,
                status: document.getElementById('memberStatus').value,
                notes: document.getElementById('memberNotes').value
            };
            
            if (currentEditingId) {
                // Update existing team member
                updateTeamMember(currentEditingId, formData);
                showNotification('Team Member Updated', `Team member "${formData.name}" has been updated`, 'success');
            } else {
                // Add new team member
                formData.id = generateId();
                addTeamMember(formData);
                showNotification('Team Member Added', `New team member "${formData.name}" has been added`, 'success');
            }
            
            closeModals();
        }

        // Handle expense form submission
        function handleExpenseSubmit(e) {
            e.preventDefault();
            
            const formData = {
                id: generateId(),
                expenseName: document.getElementById('expenseName').value,
                expenseAmount: parseFloat(document.getElementById('expenseAmount').value).toFixed(2),
                expenseDate: document.getElementById('expenseDate').value
            };
            
            addExpense(formData);
            showNotification('Expense Added', `New expense "${formData.expenseName}" has been added`, 'success');
            closeModals();
        }

        // Add new order
        function addOrder(orderData) {
            orders.push(orderData);
            saveToLocalStorage();
            renderOrders();
            renderTeamStats();
            renderClients();
            updateFinance();
        }

        // Update existing order
        function updateOrder(orderId, orderData) {
            const index = orders.findIndex(o => o.id === orderId);
            if (index !== -1) {
                orders[index] = { ...orders[index], ...orderData };
                saveToLocalStorage();
                renderOrders();
                renderTeamStats();
                renderClients();
                updateFinance();
            }
        }

        // Delete order
        function deleteOrder(orderId) {
            if (!confirm('Are you sure you want to delete this order?')) return;
            
            const order = orders.find(o => o.id === orderId);
            orders = orders.filter(o => o.id !== orderId);
            saveToLocalStorage();
            renderOrders();
            renderTeamStats();
            renderClients();
            updateFinance();
            
            if (order) {
                showNotification('Order Deleted', `Order "${order.projectName}" has been deleted`, 'warning');
            }
        }

        // Add new team member
        function addTeamMember(memberData) {
            teamMembers.push(memberData);
            saveToLocalStorage();
            renderTeamStats();
        }

        // Update existing team member
        function updateTeamMember(memberId, memberData) {
            const index = teamMembers.findIndex(m => m.id === memberId);
            if (index !== -1) {
                teamMembers[index] = { ...teamMembers[index], ...memberData };
                saveToLocalStorage();
                renderTeamStats();
            }
        }

        // Delete team member
        function deleteTeamMember(memberId) {
            if (!confirm('Are you sure you want to delete this team member?')) return;
            
            const member = teamMembers.find(m => m.id === memberId);
            teamMembers = teamMembers.filter(m => m.id !== memberId);
            saveToLocalStorage();
            renderTeamStats();
            
            if (member) {
                showNotification('Team Member Deleted', `Team member "${member.name}" has been deleted`, 'warning');
            }
        }

        // Add expense
        function addExpense(expenseData) {
            expenses.push(expenseData);
            saveToLocalStorage();
            updateFinance();
        }

        // Render team stats
        function renderTeamStats() {
            const now = new Date();
            const currentMonth = now.getMonth();
            const currentYear = now.getFullYear();
            
            // Calculate team stats
            const teamStats = teamMembers.map(member => {
                const editorOrders = orders.filter(order => order.assignedEditor === member.name);
                const thisMonthOrders = editorOrders.filter(order => {
                    const orderDate = new Date(order.projectDate);
                    return orderDate.getMonth() === currentMonth && orderDate.getFullYear() === currentYear;
                });
                const pendingOrders = editorOrders.filter(order => order.projectStatus !== 'Final Delivery');
                const completedOrders = editorOrders.filter(order => order.projectStatus === 'Final Delivery');
                
                // Calculate total earnings (editor payments)
                const totalEarnings = editorOrders.reduce((sum, order) => {
                    return sum + parseFloat(order.editorPayment || 0);
                }, 0);
                
                // Calculate pending payments
                const pendingPayments = editorOrders
                    .filter(order => order.paymentStatus !== 'Paid')
                    .reduce((sum, order) => {
                        return sum + parseFloat(order.editorPayment || 0);
                    }, 0);
                
                return {
                    id: member.id,
                    name: member.name,
                    role: member.role,
                    whatsapp: member.whatsapp,
                    status: member.status,
                    totalProjects: editorOrders.length,
                    thisMonth: thisMonthOrders.length,
                    pending: pendingOrders.length,
                    completed: completedOrders.length,
                    totalEarnings: totalEarnings,
                    pendingPayments: pendingPayments
                };
            });
            
            // Update stats grid
            const statsGrid = document.querySelector('#teamDashboard .stats-grid');
            statsGrid.innerHTML = teamStats.map(stat => `
                <div class="stat-card">
                    <div class="stat-label">${stat.name}'s Projects</div>
                    <div class="stat-value">${stat.totalProjects}</div>
                    <div class="stat-label">Earnings: ${formatCurrency(stat.totalEarnings)}</div>
                    <div class="stat-label">Pending: ${formatCurrency(stat.pendingPayments)}</div>
                </div>
            `).join('');
            
            // Update team table
            if (teamStats.length === 0) {
                teamTableBody.innerHTML = `
                    <tr>
                        <td colspan="10" class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <div>No team members found</div>
                        </td>
                    </tr>
                `;
            } else {
                teamTableBody.innerHTML = teamStats.map(stat => `
                    <tr>
                        <td>${stat.name}</td>
                        <td>${stat.role}</td>
                        <td>
                            <a href="https://wa.me/${stat.whatsapp || ''}?text=Hello" 
                               target="_blank" class="whatsapp-link">
                                üì± Contact
                            </a>
                        </td>
                        <td>${stat.totalProjects}</td>
                        <td>${stat.thisMonth}</td>
                        <td>${stat.pending}</td>
                        <td>${stat.completed}</td>
                        <td>${formatCurrency(stat.totalEarnings)}</td>
                        <td>${formatCurrency(stat.pendingPayments)}</td>
                        <td>
                            <button class="btn btn-secondary btn-small edit-team-member" data-id="${stat.id}">
                                Edit
                            </button>
                            <button class="btn btn-danger btn-small delete-team-member" data-id="${stat.id}">
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-team-member').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const memberId = e.target.dataset.id;
                        openTeamMemberModal(memberId);
                    });
                });
                
                document.querySelectorAll('.delete-team-member').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const memberId = e.target.dataset.id;
                        deleteTeamMember(memberId);
                    });
                });
            }
        }

        // Update finance dashboard
        function updateFinance() {
            const selectedMonth = monthPicker.value;
            if (!selectedMonth) return;
            
            const [year, month] = selectedMonth.split('-').map(Number);
            
            // Calculate income from orders
            const monthOrders = orders.filter(order => {
                const orderDate = new Date(order.projectDate);
                return orderDate.getFullYear() === year && orderDate.getMonth() === month - 1;
            });
            
            // Calculate income
            const income = monthOrders.reduce((sum, order) => {
                return sum + parseFloat(order.projectPrice || 0);
            }, 0);
            
            // Calculate expenses
            const monthExpenses = expenses.filter(expense => {
                const expenseDate = new Date(expense.expenseDate);
                return expenseDate.getFullYear() === year && expenseDate.getMonth() === month - 1;
            });
            
            // Calculate expenses
            const expenseTotal = monthExpenses.reduce((sum, expense) => {
                return sum + parseFloat(expense.expenseAmount || 0);
            }, 0);
            
            // Calculate editor payments (paid ones)
            const editorPayments = monthOrders
                .filter(order => order.paymentStatus === 'Paid')
                .reduce((sum, order) => {
                    return sum + parseFloat(order.editorPayment || 0);
                }, 0);
            
            const totalExpense = expenseTotal + editorPayments;
            const profit = income - totalExpense;
            
            // Update UI
            totalIncomeEl.textContent = formatCurrency(income);
            totalExpenseEl.textContent = formatCurrency(totalExpense);
            editorPaymentsEl.textContent = formatCurrency(editorPayments);
            profitEl.textContent = formatCurrency(profit);
            profitEl.style.color = profit >= 0 ? 'var(--success)' : 'var(--danger)';
            
            // Update expenses table
            if (monthExpenses.length === 0) {
                expensesTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <div class="empty-state-icon">üí∞</div>
                            <div>No expenses for this month</div>
                        </td>
                    </tr>
                `;
            } else {
                expensesTableBody.innerHTML = monthExpenses.map(expense => `
                    <tr>
                        <td>${expense.expenseName || 'N/A'}</td>
                        <td>${formatCurrency(expense.expenseAmount || 0)}</td>
                        <td>${formatDate(expense.expenseDate)}</td>
                        <td>
                            <button class="btn btn-danger btn-small delete-expense" data-id="${expense.id}">
                                Delete
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-expense').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const expenseId = e.target.dataset.id;
                        deleteExpense(expenseId);
                    });
                });
            }
            
            // Update pending payments table
            const pendingPayments = monthOrders.filter(order => order.paymentStatus !== 'Paid');
            if (pendingPayments.length === 0) {
                paymentsTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="empty-state">
                            <div class="empty-state-icon">üí≥</div>
                            <div>No pending payments for this month</div>
                        </td>
                    </tr>
                `;
            } else {
                paymentsTableBody.innerHTML = pendingPayments.map(order => `
                    <tr>
                        <td>${order.assignedEditor || 'N/A'}</td>
                        <td>${order.projectName || 'N/A'}</td>
                        <td>${formatCurrency(order.editorPayment || 0)}</td>
                        <td>
                            <span class="payment-status payment-pending">
                                ${order.paymentStatus || 'Pending'}
                            </span>
                        </td>
                        <td>${formatDate(order.projectDate)}</td>
                        <td>
                            <button class="btn btn-success btn-small mark-paid" data-id="${order.id}">
                                Mark Paid
                            </button>
                        </td>
                    </tr>
                `).join('');
                
                // Add event listeners to mark paid buttons
                document.querySelectorAll('#paymentsTableBody .mark-paid').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const orderId = e.target.dataset.id;
                        markPaymentAsPaid(orderId);
                    });
                });
            }
        }

        // Delete expense
        function deleteExpense(expenseId) {
            if (!confirm('Are you sure you want to delete this expense?')) return;
            
            const expense = expenses.find(e => e.id === expenseId);
            expenses = expenses.filter(e => e.id !== expenseId);
            saveToLocalStorage();
            updateFinance();
            
            if (expense) {
                showNotification('Expense Deleted', `Expense "${expense.expenseName}" has been deleted`, 'warning');
            }
        }

        // Render clients directory
        function renderClients() {
            // Group orders by client
            const clientsMap = {};
            
            orders.forEach(order => {
                if (!order.clientName) return;
                
                if (!clientsMap[order.clientName]) {
                    clientsMap[order.clientName] = {
                        name: order.clientName,
                        whatsapp: order.whatsappNumber,
                        totalOrders: 0,
                        totalAmount: 0
                    };
                }
                
                clientsMap[order.clientName].totalOrders++;
                clientsMap[order.clientName].totalAmount += parseFloat(order.projectPrice || 0);
            });
            
            const clients = Object.values(clientsMap);
            
            // Calculate total revenue
            const totalRevenue = orders.reduce((sum, order) => {
                return sum + parseFloat(order.projectPrice || 0);
            }, 0);
            
            // Update stats grid
            const statsGrid = document.querySelector('#clientsDashboard .stats-grid');
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-label">Total Clients</div>
                    <div class="stat-value">${clients.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Orders</div>
                    <div class="stat-value">${orders.length}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Revenue</div>
                    <div class="stat-value">${formatCurrency(totalRevenue)}</div>
                </div>
            `;
            
            // Update clients table
            if (clients.length === 0) {
                clientsTableBody.innerHTML = `
                    <tr>
                        <td colspan="4" class="empty-state">
                            <div class="empty-state-icon">üë•</div>
                            <div>No clients found</div>
                        </td>
                    </tr>
                `;
            } else {
                clientsTableBody.innerHTML = clients.map(client => `
                    <tr>
                        <td>${client.name}</td>
                        <td>
                            <a href="https://wa.me/${client.whatsapp || ''}?text=Hello Motioncraft" 
                               target="_blank" class="whatsapp-link">
                                üì± Chat
                            </a>
                        </td>
                        <td>${client.totalOrders}</td>
                        <td>${formatCurrency(client.totalAmount)}</td>
                    </tr>
                `).join('');
            }
        }

        // Export orders to CSV
        function exportOrdersToCSV() {
            if (orders.length === 0) {
                alert('No orders to export');
                return;
            }
            
            const headers = ['Client Name', 'Project Name', 'Price', 'Editor Payment', 'Payment Status', 'WhatsApp', 'Editor', 'Status', 'Date', 'Notes'];
            const csvContent = [
                headers.join(','),
                ...orders.map(order => [
                    `"${order.clientName || ''}"`,
                    `"${order.projectName || ''}"`,
                    order.projectPrice || 0,
                    order.editorPayment || 0,
                    order.paymentStatus || 'Pending',
                    order.whatsappNumber || '',
                    order.assignedEditor || '',
                    order.projectStatus || '',
                    order.projectDate || '',
                    `"${order.notes || ''}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `motioncraft-orders-${new Date().toISOString().slice(0, 10)}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Download all data as JSON
        function downloadData() {
            const data = {
                orders: orders,
                expenses: expenses,
                teamMembers: teamMembers
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `motioncraft-data-${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Upload data from JSON file
        function uploadData() {
            const file = uploadDataInput.files[0];
            if (!file) {
                alert('Please select a file to upload');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (!data.orders || !data.expenses || !data.teamMembers) {
                        throw new Error('Invalid data format');
                    }
                    
                    if (confirm('This will replace all your current data. Are you sure?')) {
                        orders = data.orders;
                        expenses = data.expenses;
                        teamMembers = data.teamMembers;
                        saveToLocalStorage();
                        
                        // Refresh all displays
                        renderOrders();
                        renderTeamStats();
                        updateFinance();
                        renderClients();
                        
                        alert('Data uploaded successfully!');
                        uploadDataInput.value = '';
                    }
                } catch (error) {
                    alert('Error uploading data: Invalid file format');
                    console.error(error);
                }
            };
            reader.readAsText(file);
        }

        // Format currency
        function formatCurrency(amount) {
            return `$${parseFloat(amount || 0).toFixed(2)}`;
        }

        // Utility function to generate unique ID
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Utility function to format date
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
    </script>
</body>
</html>
