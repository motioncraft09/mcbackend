<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Motioncraft Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --secondary: #64748b;
            --accent: #f59e0b;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --dark: #1e293b;
            --light: #f8fafc;
            --glass: rgba(255, 255, 255, 0.7);
            --glass-border: rgba(255, 255, 255, 0.4);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            color: #1e293b;
            min-height: 100vh;
        }

        .glass {
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
        }

        .card {
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            background: white;
            width: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .kanban-column {
            border-radius: 12px;
            min-height: 500px;
        }

        .kanban-card {
            cursor: grab;
            transition: all 0.2s ease;
            border-radius: 12px;
            background: white;
        }

        .kanban-card:active {
            cursor: grabbing;
        }

        .kanban-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .status-fresh { background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); }
        .status-scripting { background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); }
        .status-editing { background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); }
        .status-correction { background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); }
        .status-final_delivery { background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); }
        .status-completed { background: linear-gradient(135deg, #e0e7ff 0%, #c7d2fe 100%); }

        .nav-link.active {
            background: var(--primary);
            color: white;
        }

        /* Main Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 260px;
            min-height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            z-index: 40;
            transition: transform 0.3s ease;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 260px;
            width: calc(100% - 260px);
            min-height: 100vh;
        }

        /* Mobile Overlay */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 30;
        }

        .overlay.active {
            display: block;
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            position: fixed;
            top: 1rem;
            left: 1rem;
            z-index: 50;
        }

        /* Sections */
        .section {
            display: none;
            padding: 1.5rem;
            width: 100%;
        }

        .section.active {
            display: block;
        }

        /* Kanban Board */
        .kanban-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 1rem;
            width: 100%;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            width: 100%;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
            width: 100%;
        }

        /* Charts Grid */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            width: 100%;
        }

        /* Team Grid */
        .team-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            width: 100%;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .kanban-container {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .team-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .app-container {
                flex-direction: column;
            }
            
            .sidebar {
                transform: translateX(-100%);
                width: 280px;
            }
            
            .sidebar.active {
                transform: translateX(0);
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .section {
                padding: 1rem;
            }
            
            .kanban-container {
                display: flex;
                overflow-x: auto;
                gap: 1rem;
                padding-bottom: 1rem;
            }
            
            .kanban-column {
                min-width: 280px;
                min-height: 400px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .team-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .kanban-column {
                min-width: 260px;
            }
            
            .section {
                padding: 0.75rem;
            }
        }

        /* Currency */
        .currency-bdt::before {
            content: "৳";
            margin-right: 2px;
        }

        .currency-usd::before {
            content: "$";
            margin-right: 2px;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Toast */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            display: none;
        }

        .toast.success {
            background: #10b981;
        }

        .toast.error {
            background: #ef4444;
        }

        .toast.info {
            background: #3b82f6;
        }

        .toast.warning {
            background: #f59e0b;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Mobile Menu Button -->
        <button class="mobile-menu-btn p-3 rounded-full glass text-gray-700">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Overlay -->
        <div class="overlay"></div>

        <!-- Sidebar -->
        <div class="sidebar glass p-6">
            <div class="flex items-center justify-center mb-10">
                <div class="w-12 h-12 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center text-white font-bold text-xl">M</div>
                <h1 class="text-xl font-bold ml-3 text-gray-800">Motioncraft</h1>
            </div>

            <nav class="space-y-2">
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors active" data-section="overview">
                    <i class="fas fa-chart-pie w-6 mr-3"></i>
                    <span>Overview</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="kanban">
                    <i class="fas fa-columns w-6 mr-3"></i>
                    <span>Kanban Board</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="orders">
                    <i class="fas fa-list-ul w-6 mr-3"></i>
                    <span>Orders</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="team">
                    <i class="fas fa-users w-6 mr-3"></i>
                    <span>Team</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="finance">
                    <i class="fas fa-chart-line w-6 mr-3"></i>
                    <span>Finance</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="clients">
                    <i class="fas fa-user-friends w-6 mr-3"></i>
                    <span>Clients</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="activity">
                    <i class="fas fa-history w-6 mr-3"></i>
                    <span>Activity</span>
                </a>
                <a href="#" class="nav-link flex items-center p-3 rounded-xl text-gray-700 hover:bg-white transition-colors" data-section="settings">
                    <i class="fas fa-cog w-6 mr-3"></i>
                    <span>Settings</span>
                </a>
            </nav>

            <div class="mt-10 pt-6 border-t border-gray-200">
                <div class="flex items-center">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 flex items-center justify-center text-white font-bold">A</div>
                    <div class="ml-3">
                        <p class="text-sm font-medium text-gray-800">Admin User</p>
                        <p class="text-xs text-gray-500">Owner</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="glass p-6 mb-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                    <div class="mb-4 md:mb-0">
                        <h1 class="text-2xl font-bold text-gray-800" id="sectionTitle">Dashboard Overview</h1>
                        <p class="text-gray-600">Welcome back! Here's what's happening today.</p>
                    </div>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center w-full md:w-auto">
                        <div class="relative w-full sm:w-64 mb-2 sm:mb-0 sm:mr-4">
                            <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                            <input type="text" placeholder="Search..." class="pl-10 pr-4 py-2 rounded-xl border border-gray-200 bg-white focus:outline-none focus:ring-2 focus:ring-indigo-500 w-full">
                        </div>
                        <div class="flex items-center">
                            <div class="relative">
                                <button class="p-2 rounded-full bg-white shadow-sm">
                                    <i class="fas fa-bell text-gray-600"></i>
                                </button>
                                <span class="absolute top-0 right-0 w-3 h-3 bg-red-500 rounded-full"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Overview Section -->
            <section id="overview" class="section active fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Key Metrics</h2>
                    <div class="flex items-center">
                        <label class="text-sm text-gray-600 mr-2">Select Month:</label>
                        <input type="month" id="monthPicker" class="p-2 rounded-lg border border-gray-200 bg-white">
                    </div>
                </div>

                <div class="stats-grid mb-8">
                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-blue-100 text-blue-600 mr-4">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Orders</p>
                                <h3 class="text-2xl font-bold text-gray-800" id="totalOrders">0</h3>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">This Month Orders</p>
                                <h3 class="text-2xl font-bold text-gray-800" id="monthOrders">0</h3>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-purple-100 text-purple-600 mr-4">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Paid Amount</p>
                                <h3 class="text-2xl font-bold text-gray-800 currency-bdt" id="paidAmount">0</h3>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Pending Amount</p>
                                <h3 class="text-2xl font-bold text-gray-800 currency-bdt" id="pendingAmount">0</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="charts-grid gap-6 mb-8">
                    <div class="card glass p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Total Income</h3>
                            <span class="text-green-600 font-medium currency-bdt" id="totalIncome">0</span>
                        </div>
                        <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
                            <canvas id="incomeChart"></canvas>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Expenses</h3>
                            <span class="text-red-600 font-medium currency-bdt" id="totalExpense">0</span>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm text-gray-600 mb-2">Add Expense</label>
                            <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-2">
                                <input type="number" id="expenseAmount" placeholder="Amount" class="flex-1 p-2 rounded-lg border border-gray-200 bg-white">
                                <input type="text" id="expenseDescription" placeholder="Description" class="flex-1 p-2 rounded-lg border border-gray-200 bg-white">
                                <button id="addExpense" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors">Add</button>
                            </div>
                        </div>
                        <div class="h-40 overflow-y-auto">
                            <ul id="expenseList" class="space-y-2">
                                <!-- Expenses will be populated dynamically -->
                            </ul>
                        </div>
                    </div>
                </div>

                <div class="card glass p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Recent Activity</h3>
                    <div class="space-y-4" id="recentActivity">
                        <!-- Activity will be populated dynamically -->
                    </div>
                </div>
            </section>

            <!-- Kanban Board Section -->
            <section id="kanban" class="section hidden fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Project Kanban Board</h2>
                    <button id="addOrderBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i> Add Order
                    </button>
                </div>

                <div class="kanban-container">
                    <div class="kanban-column status-fresh p-4" data-status="fresh">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Fresh</h3>
                        <div class="space-y-4" id="fresh-column">
                            <!-- Kanban cards will be populated dynamically -->
                        </div>
                    </div>

                    <div class="kanban-column status-scripting p-4" data-status="scripting">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Scripting</h3>
                        <div class="space-y-4" id="scripting-column">
                            <!-- Kanban cards will be populated dynamically -->
                        </div>
                    </div>

                    <div class="kanban-column status-editing p-4" data-status="editing">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Editing</h3>
                        <div class="space-y-4" id="editing-column">
                            <!-- Kanban cards will be populated dynamically -->
                        </div>
                    </div>

                    <div class="kanban-column status-correction p-4" data-status="correction">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Correction</h3>
                        <div class="space-y-4" id="correction-column">
                            <!-- Kanban cards will be populated dynamically -->
                        </div>
                    </div>

                    <div class="kanban-column status-final_delivery p-4" data-status="final_delivery">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Final Delivery</h3>
                        <div class="space-y-4" id="final_delivery-column">
                            <!-- Kanban cards will be populated dynamically -->
                        </div>
                    </div>

                    <div class="kanban-column status-completed p-4" data-status="completed">
                        <h3 class="font-semibold text-gray-800 mb-4 text-center">Completed</h3>
                        <div class="space-y-4" id="completed-column">
                            <!-- Kanban cards will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Orders Section -->
            <section id="orders" class="section hidden fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Orders Management</h2>
                    <button id="addOrderBtn2" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i> Add Order
                    </button>
                </div>

                <div class="card glass p-6 mb-6">
                    <div class="flex flex-col space-y-4">
                        <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-4 md:space-y-0">
                            <div class="w-full md:w-auto">
                                <label class="block text-sm text-gray-600 mb-1">Filter by Editor</label>
                                <select id="editorFilter" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                    <option value="">All Editors</option>
                                    <!-- Editors will be populated dynamically -->
                                </select>
                            </div>
                            <div class="w-full md:w-auto">
                                <label class="block text-sm text-gray-600 mb-1">Filter by Status</label>
                                <select id="statusFilter" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                    <option value="">All Statuses</option>
                                    <option value="fresh">Fresh</option>
                                    <option value="scripting">Scripting</option>
                                    <option value="editing">Editing</option>
                                    <option value="correction">Correction</option>
                                    <option value="final_delivery">Final Delivery</option>
                                    <option value="completed">Completed</option>
                                </select>
                            </div>
                            <div class="w-full md:w-auto">
                                <label class="block text-sm text-gray-600 mb-1">Payment Status</label>
                                <select id="paymentFilter" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                    <option value="">All</option>
                                    <option value="yes">Paid</option>
                                    <option value="no">Unpaid</option>
                                </select>
                            </div>
                        </div>
                        <div class="w-full md:w-64">
                            <div class="relative">
                                <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
                                <input type="text" id="orderSearch" placeholder="Search orders..." class="w-full pl-10 pr-4 py-2 rounded-lg border border-gray-200 bg-white">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card glass p-6">
                    <div class="table-container">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Order #</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Client</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Project</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Status</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Editor</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Price</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Due Date</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <!-- Orders will be populated dynamically -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Team Section -->
            <section id="team" class="section hidden fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Team Management</h2>
                    <button id="addMemberBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i> Add Member
                    </button>
                </div>

                <div class="team-grid mb-8" id="teamContainer">
                    <!-- Team members will be populated dynamically -->
                </div>

                <div class="card glass p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Bulk Actions</h3>
                    <div class="flex flex-col md:flex-row md:items-center space-y-4 md:space-y-0 md:space-x-4">
                        <div class="flex-1">
                            <label class="block text-sm text-gray-600 mb-1">Reassign projects from:</label>
                            <select id="reassignFrom" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                <option value="">Select member</option>
                                <!-- Team members will be populated dynamically -->
                            </select>
                        </div>
                        <div class="flex-1">
                            <label class="block text-sm text-gray-600 mb-1">Reassign projects to:</label>
                            <select id="reassignTo" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                <option value="">Select member</option>
                                <!-- Team members will be populated dynamically -->
                            </select>
                        </div>
                        <div class="mt-4 md:mt-6">
                            <button id="reassignBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                                Reassign Projects
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Finance Section -->
            <section id="finance" class="section hidden fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Finance Overview</h2>
                    <div class="flex flex-col sm:flex-row items-start sm:items-center">
                        <div class="mb-2 sm:mb-0 sm:mr-4">
                            <label class="text-sm text-gray-600 mr-2">Select Month:</label>
                            <input type="month" id="financeMonthPicker" class="p-2 rounded-lg border border-gray-200 bg-white">
                        </div>
                        <button id="exportCSV" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-file-export mr-2"></i> Export CSV
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-green-100 text-green-600 mr-4">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Income</p>
                                <h3 class="text-2xl font-bold text-gray-800 currency-bdt" id="financeIncome">0</h3>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-yellow-100 text-yellow-600 mr-4">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Pending Amount</p>
                                <h3 class="text-2xl font-bold text-gray-800 currency-bdt" id="financePending">0</h3>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <div class="flex items-center">
                            <div class="p-3 rounded-full bg-red-100 text-red-600 mr-4">
                                <i class="fas fa-receipt"></i>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Expenses</p>
                                <h3 class="text-2xl font-bold text-gray-800 currency-bdt" id="financeExpenses">0</h3>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card glass p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Income vs Expenses</h3>
                        <div class="chart-container">
                            <canvas id="financeChart"></canvas>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Expense Breakdown</h3>
                        <div class="h-64 overflow-y-auto">
                            <ul id="financeExpenseList" class="space-y-2">
                                <!-- Expenses will be listed here -->
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Clients Section -->
            <section id="clients" class="section hidden fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Clients Management</h2>
                    <button id="addClientBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i> Add Client
                    </button>
                </div>

                <div class="card glass p-6">
                    <div class="table-container">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Client Name</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">WhatsApp</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Projects</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Total Paid</th>
                                    <th class="text-left py-3 px-4 text-gray-600 font-medium">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="clientsTableBody">
                                <!-- Clients will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Activity Section -->
            <section id="activity" class="section hidden fade-in">
                <div class="mb-6 flex flex-col md:flex-row justify-between items-start md:items-center">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4 md:mb-0">Activity Timeline</h2>
                    <button id="clearActivityBtn" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash mr-2"></i> Clear Activity
                    </button>
                </div>

                <div class="card glass p-6">
                    <div class="space-y-6" id="activityTimeline">
                        <!-- Activity items will be added here -->
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="section hidden fade-in">
                <div class="mb-6">
                    <h2 class="text-xl font-semibold text-gray-800">Settings</h2>
                    <p class="text-gray-600">Configure your dashboard and integrations</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card glass p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">SheetDB Integration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Orders Sheet Endpoint</label>
                                <input type="text" id="ordersEndpoint" class="w-full p-2 rounded-lg border border-gray-200 bg-white" placeholder="https://sheetdb.io/api/v1/xxxxxxxx">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Team Sheet Endpoint</label>
                                <input type="text" id="teamEndpoint" class="w-full p-2 rounded-lg border border-gray-200 bg-white" placeholder="https://sheetdb.io/api/v1/xxxxxxxx">
                            </div>
                            <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="saveEndpoints" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                                    Save Endpoints
                                </button>
                                <button id="testEndpoints" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                    Test Connection
                                </button>
                            </div>
                            <div class="mt-4 p-3 bg-blue-50 rounded-lg">
                                <p class="text-sm text-blue-700">
                                    <strong>Note:</strong> Create free accounts at <a href="https://sheetdb.io" target="_blank" class="underline">sheetdb.io</a> and get your API endpoints. 
                                    The dashboard will sync with your Google Sheets automatically.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Appearance</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Currency</span>
                                <select id="currencySelect" class="p-2 rounded-lg border border-gray-200 bg-white">
                                    <option value="bdt">BDT (৳)</option>
                                    <option value="usd">USD ($)</option>
                                </select>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-gray-700">Theme</span>
                                <select id="themeSelect" class="p-2 rounded-lg border border-gray-200 bg-white">
                                    <option value="light">Light</option>
                                    <option value="dark">Dark</option>
                                    <option value="auto">Auto (System)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Data Management</h3>
                        <div class="space-y-4">
                            <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="exportData" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i> Export All Data
                                </button>
                                <button id="importData" class="px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors">
                                    <i class="fas fa-upload mr-2"></i> Import Data
                                </button>
                            </div>
                            <div class="flex flex-col sm:flex-row sm:items-center space-y-2 sm:space-y-0 sm:space-x-4">
                                <button id="resetData" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors">
                                    <i class="fas fa-refresh mr-2"></i> Reset to Sample Data
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="card glass p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">WhatsApp Integration</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm text-gray-600 mb-1">Test WhatsApp Message</label>
                                <textarea id="whatsappTest" class="w-full p-2 rounded-lg border border-gray-200 bg-white h-24" placeholder="Enter message to test WhatsApp formatting"></textarea>
                            </div>
                            <button id="testWhatsApp" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fab fa-whatsapp mr-2"></i> Test WhatsApp
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Order Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-800" id="orderModalTitle">Add New Order</h3>
            </div>
            <div class="p-6">
                <form id="orderForm">
                    <input type="hidden" id="orderId">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Order Number</label>
                            <input type="text" id="orderNumber" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Client Name</label>
                            <input type="text" id="clientName" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Client WhatsApp</label>
                            <input type="text" id="clientWhatsApp" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Project Title</label>
                            <input type="text" id="projectTitle" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Status</label>
                            <select id="orderStatus" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                <option value="fresh">Fresh</option>
                                <option value="scripting">Scripting</option>
                                <option value="editing">Editing</option>
                                <option value="correction">Correction</option>
                                <option value="final_delivery">Final Delivery</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Assigned Editor</label>
                            <select id="assignedEditor" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                <option value="">Unassigned</option>
                                <!-- Editors will be populated dynamically -->
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Price</label>
                            <input type="number" id="orderPrice" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Paid</label>
                            <select id="orderPaid" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Due Date</label>
                            <input type="date" id="dueDate" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-sm text-gray-600 mb-1">Notes</label>
                        <textarea id="orderNotes" class="w-full p-2 rounded-lg border border-gray-200 bg-white h-24"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" id="cancelOrder" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            Save Order
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Team Modal -->
    <div id="teamModal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-800" id="teamModalTitle">Add Team Member</h3>
            </div>
            <div class="p-6">
                <form id="teamForm">
                    <input type="hidden" id="memberId">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Name</label>
                            <input type="text" id="memberName" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Role</label>
                            <input type="text" id="memberRole" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">WhatsApp</label>
                            <input type="text" id="memberWhatsApp" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Current Projects Count</label>
                            <input type="number" id="projectsCount" class="w-full p-2 rounded-lg border border-gray-200 bg-white" value="0">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Monthly Earnings</label>
                            <input type="number" id="monthlyEarnings" class="w-full p-2 rounded-lg border border-gray-200 bg-white" value="0">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelTeam" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            Save Member
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Client Modal -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-semibold text-gray-800" id="clientModalTitle">Add New Client</h3>
            </div>
            <div class="p-6">
                <form id="clientForm">
                    <input type="hidden" id="clientId">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Client Name</label>
                            <input type="text" id="clientNameInput" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">WhatsApp Number</label>
                            <input type="text" id="clientWhatsAppInput" class="w-full p-2 rounded-lg border border-gray-200 bg-white" required>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Email</label>
                            <input type="email" id="clientEmail" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-600 mb-1">Company</label>
                            <input type="text" id="clientCompany" class="w-full p-2 rounded-lg border border-gray-200 bg-white">
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button type="button" id="cancelClient" class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
                            Save Client
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <div class="flex items-center">
            <i id="toastIcon" class="fas fa-info-circle mr-3"></i>
            <span id="toastMessage"></span>
        </div>
    </div>

    <!-- File Input for Import (hidden) -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <script>
        // Configuration
        const CONFIG = {
            USE_SAMPLE_DATA: true, // Set to false when using real SheetDB endpoints
            SHEETDB_ORDERS: "https://sheetdb.io/api/v1/4t736q7rxsj5z",
            SHEETDB_TEAM: "https://sheetdb.io/api/v1/7jf3yo21e6l1o"
        };

        // Application State
        const state = {
            orders: [],
            team: [],
            clients: [],
            activity: [],
            finances: {
                expenses: [],
                income: []
            },
            settings: {
                currency: 'bdt',
                theme: 'light',
                sheetDB_orders: CONFIG.SHEETDB_ORDERS,
                sheetDB_team: CONFIG.SHEETDB_TEAM,
                useSheetDB: false
            },
            currentView: 'overview'
        };

        // Sample Data
        const SAMPLE_DATA = {
            orders: [
                {
                    id: "1",
                    order_no: "MC-001",
                    client_name: "John Smith",
                    client_whatsapp: "+1234567890",
                    project_title: "Corporate Brand Video",
                    status: "fresh",
                    assigned_editor: "",
                    price: "15000",
                    paid: "no",
                    created_at: "2023-10-15",
                    due_date: "2023-11-15",
                    notes: "Client wants a modern and professional look",
                    internal_comments: "Need to assign an editor with corporate video experience"
                },
                {
                    id: "2",
                    order_no: "MC-002",
                    client_name: "Sarah Johnson",
                    client_whatsapp: "+1234567891",
                    project_title: "Product Launch Video",
                    status: "scripting",
                    assigned_editor: "1",
                    price: "20000",
                    paid: "yes",
                    created_at: "2023-10-20",
                    due_date: "2023-11-25",
                    notes: "Focus on the product's unique features",
                    internal_comments: "Script is 50% complete"
                },
                {
                    id: "3",
                    order_no: "MC-003",
                    client_name: "Mike Davis",
                    client_whatsapp: "+1234567892",
                    project_title: "Social Media Ads",
                    status: "editing",
                    assigned_editor: "2",
                    price: "8000",
                    paid: "no",
                    created_at: "2023-10-25",
                    due_date: "2023-11-05",
                    notes: "Short videos for Instagram and Facebook",
                    internal_comments: "First draft ready for review"
                }
            ],
            team: [
                {
                    id: "1",
                    name: "Alex Johnson",
                    role: "Senior Video Editor",
                    whatsapp: "+1234567896",
                    current_projects_count: "2",
                    monthly_earnings: "32000"
                },
                {
                    id: "2",
                    name: "Maria Garcia",
                    role: "Video Editor",
                    whatsapp: "+1234567897",
                    current_projects_count: "2",
                    monthly_earnings: "24000"
                },
                {
                    id: "3",
                    name: "David Kim",
                    role: "Motion Graphics Designer",
                    whatsapp: "+1234567898",
                    current_projects_count: "1",
                    monthly_earnings: "18000"
                }
            ],
            clients: [
                {
                    id: "1",
                    name: "John Smith",
                    whatsapp: "+1234567890",
                    email: "john@example.com",
                    company: "Tech Corp",
                    total_orders: 3,
                    total_paid: 35000
                },
                {
                    id: "2",
                    name: "Sarah Johnson",
                    whatsapp: "+1234567891",
                    email: "sarah@example.com",
                    company: "Startup XYZ",
                    total_orders: 2,
                    total_paid: 28000
                }
            ],
            activity: [
                {
                    id: "1",
                    type: "order_created",
                    description: "New order MC-001 created",
                    timestamp: new Date().toISOString()
                },
                {
                    id: "2",
                    type: "status_changed",
                    description: "Order MC-002 status changed to scripting",
                    timestamp: new Date().toISOString()
                }
            ]
        };

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
        });

        function initApp() {
            loadData();
            setupEventListeners();
            renderAllSections();
            updateStats();
            initCharts();
        }

        function loadData() {
            // Load settings from localStorage
            const savedSettings = localStorage.getItem('motioncraft_settings');
            if (savedSettings) {
                state.settings = { ...state.settings, ...JSON.parse(savedSettings) };
            }

            // Load data from localStorage
            const savedOrders = localStorage.getItem('motioncraft_orders');
            const savedTeam = localStorage.getItem('motioncraft_team');
            const savedClients = localStorage.getItem('motioncraft_clients');
            const savedActivity = localStorage.getItem('motioncraft_activity');
            const savedExpenses = localStorage.getItem('motioncraft_expenses');

            if (savedOrders) {
                state.orders = JSON.parse(savedOrders);
            } else {
                state.orders = [...SAMPLE_DATA.orders];
            }

            if (savedTeam) {
                state.team = JSON.parse(savedTeam);
            } else {
                state.team = [...SAMPLE_DATA.team];
            }

            if (savedClients) {
                state.clients = JSON.parse(savedClients);
            } else {
                state.clients = [...SAMPLE_DATA.clients];
            }

            if (savedActivity) {
                state.activity = JSON.parse(savedActivity);
            } else {
                state.activity = [...SAMPLE_DATA.activity];
            }

            if (savedExpenses) {
                state.finances.expenses = JSON.parse(savedExpenses);
            }

            // Update UI with settings
            updateSettingsUI();
        }

        function saveData() {
            localStorage.setItem('motioncraft_orders', JSON.stringify(state.orders));
            localStorage.setItem('motioncraft_team', JSON.stringify(state.team));
            localStorage.setItem('motioncraft_clients', JSON.stringify(state.clients));
            localStorage.setItem('motioncraft_activity', JSON.stringify(state.activity));
            localStorage.setItem('motioncraft_expenses', JSON.stringify(state.finances.expenses));
        }

        function setupEventListeners() {
            // Mobile Menu
            document.querySelector('.mobile-menu-btn').addEventListener('click', toggleMobileMenu);
            document.querySelector('.overlay').addEventListener('click', toggleMobileMenu);

            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSection(link.dataset.section);
                    updateActiveNav(link);
                });
            });

            // Order Management
            document.getElementById('addOrderBtn').addEventListener('click', () => openOrderModal());
            document.getElementById('addOrderBtn2').addEventListener('click', () => openOrderModal());
            document.getElementById('orderForm').addEventListener('submit', saveOrder);
            document.getElementById('cancelOrder').addEventListener('click', closeOrderModal);

            // Team Management
            document.getElementById('addMemberBtn').addEventListener('click', () => openTeamModal());
            document.getElementById('teamForm').addEventListener('submit', saveTeamMember);
            document.getElementById('cancelTeam').addEventListener('click', closeTeamModal);
            document.getElementById('reassignBtn').addEventListener('click', reassignProjects);

            // Client Management
            document.getElementById('addClientBtn').addEventListener('click', () => openClientModal());
            document.getElementById('clientForm').addEventListener('submit', saveClient);
            document.getElementById('cancelClient').addEventListener('click', closeClientModal);

            // Finance
            document.getElementById('addExpense').addEventListener('click', addExpense);
            document.getElementById('exportCSV').addEventListener('click', exportCSV);

            // Activity
            document.getElementById('clearActivityBtn').addEventListener('click', clearActivity);

            // Settings
            document.getElementById('saveEndpoints').addEventListener('click', saveEndpoints);
            document.getElementById('testEndpoints').addEventListener('click', testEndpoints);
            document.getElementById('testWhatsApp').addEventListener('click', testWhatsApp);
            document.getElementById('exportData').addEventListener('click', exportData);
            document.getElementById('importData').addEventListener('click', importData);
            document.getElementById('resetData').addEventListener('click', resetData);
            document.getElementById('currencySelect').addEventListener('change', updateCurrency);
            document.getElementById('themeSelect').addEventListener('change', updateTheme);

            // Filters
            document.getElementById('editorFilter').addEventListener('change', filterOrders);
            document.getElementById('statusFilter').addEventListener('change', filterOrders);
            document.getElementById('paymentFilter').addEventListener('change', filterOrders);
            document.getElementById('orderSearch').addEventListener('input', filterOrders);

            // Event delegation for dynamic elements
            document.addEventListener('click', function(e) {
                // Delete order
                if (e.target.closest('.delete-order')) {
                    const orderId = e.target.closest('.delete-order').dataset.id;
                    deleteOrder(orderId);
                }
                
                // Edit order
                if (e.target.closest('.edit-order')) {
                    const orderId = e.target.closest('.edit-order').dataset.id;
                    openOrderModal(orderId);
                }
                
                // WhatsApp order
                if (e.target.closest('.whatsapp-order')) {
                    const orderId = e.target.closest('.whatsapp-order').dataset.id;
                    const order = state.orders.find(o => o.id === orderId);
                    if (order) {
                        openWhatsApp(order.client_whatsapp, `Hello ${order.client_name}, regarding your order ${order.order_no}`);
                    }
                }
                
                // Delete team member
                if (e.target.closest('.delete-member')) {
                    const memberId = e.target.closest('.delete-member').dataset.id;
                    deleteTeamMember(memberId);
                }
                
                // Edit team member
                if (e.target.closest('.edit-member')) {
                    const memberId = e.target.closest('.edit-member').dataset.id;
                    openTeamModal(memberId);
                }
                
                // Delete client
                if (e.target.closest('.delete-client')) {
                    const clientId = e.target.closest('.delete-client').dataset.id;
                    deleteClient(clientId);
                }
                
                // Edit client
                if (e.target.closest('.edit-client')) {
                    const clientId = e.target.closest('.edit-client').dataset.id;
                    openClientModal(clientId);
                }
                
                // Delete expense
                if (e.target.closest('.delete-expense')) {
                    const expenseId = e.target.closest('.delete-expense').dataset.id;
                    deleteExpense(expenseId);
                }
            });

            // Drag and drop for kanban
            setupDragAndDrop();
        }

        function toggleMobileMenu() {
            document.querySelector('.sidebar').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            document.getElementById(sectionName).classList.add('active');
            
            // Update section title
            document.getElementById('sectionTitle').textContent = 
                document.querySelector(`[data-section="${sectionName}"] span`).textContent;
            
            // Close mobile menu
            toggleMobileMenu();
        }

        function updateActiveNav(activeLink) {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            activeLink.classList.add('active');
        }

        // Order Management Functions
        function openOrderModal(orderId = null) {
            const modal = document.getElementById('orderModal');
            const title = document.getElementById('orderModalTitle');
            const form = document.getElementById('orderForm');
            
            if (orderId) {
                // Edit existing order
                const order = state.orders.find(o => o.id === orderId);
                if (order) {
                    title.textContent = 'Edit Order';
                    document.getElementById('orderId').value = order.id;
                    document.getElementById('orderNumber').value = order.order_no;
                    document.getElementById('clientName').value = order.client_name;
                    document.getElementById('clientWhatsApp').value = order.client_whatsapp;
                    document.getElementById('projectTitle').value = order.project_title;
                    document.getElementById('orderStatus').value = order.status;
                    document.getElementById('assignedEditor').value = order.assigned_editor;
                    document.getElementById('orderPrice').value = order.price;
                    document.getElementById('orderPaid').value = order.paid;
                    document.getElementById('dueDate').value = order.due_date;
                    document.getElementById('orderNotes').value = order.notes || '';
                }
            } else {
                // Add new order
                title.textContent = 'Add New Order';
                form.reset();
                document.getElementById('orderId').value = '';
            }
            
            // Populate assigned editor dropdown
            populateEditorDropdown();
            
            modal.classList.add('active');
        }

        function closeOrderModal() {
            document.getElementById('orderModal').classList.remove('active');
        }

        function saveOrder(e) {
            e.preventDefault();
            
            const orderId = document.getElementById('orderId').value;
            const orderData = {
                order_no: document.getElementById('orderNumber').value,
                client_name: document.getElementById('clientName').value,
                client_whatsapp: document.getElementById('clientWhatsApp').value,
                project_title: document.getElementById('projectTitle').value,
                status: document.getElementById('orderStatus').value,
                assigned_editor: document.getElementById('assignedEditor').value,
                price: document.getElementById('orderPrice').value,
                paid: document.getElementById('orderPaid').value,
                due_date: document.getElementById('dueDate').value,
                notes: document.getElementById('orderNotes').value,
                created_at: new Date().toISOString().split('T')[0]
            };
            
            if (orderId) {
                // Update existing order
                const index = state.orders.findIndex(o => o.id === orderId);
                if (index !== -1) {
                    state.orders[index] = { ...state.orders[index], ...orderData };
                    showToast('Order updated successfully!', 'success');
                    addActivity(`Order ${orderData.order_no} updated`);
                }
            } else {
                // Add new order
                const newOrder = {
                    id: Date.now().toString(),
                    ...orderData
                };
                state.orders.push(newOrder);
                showToast('Order created successfully!', 'success');
                addActivity(`New order ${orderData.order_no} created`);
            }
            
            saveData();
            closeOrderModal();
            renderOrdersTable();
            updateKanbanBoard();
            updateStats();
        }

        function deleteOrder(orderId) {
            if (confirm('Are you sure you want to delete this order?')) {
                const order = state.orders.find(o => o.id === orderId);
                state.orders = state.orders.filter(o => o.id !== orderId);
                
                showToast('Order deleted successfully!', 'success');
                addActivity(`Order ${order.order_no} deleted`);
                
                saveData();
                renderOrdersTable();
                updateKanbanBoard();
                updateStats();
            }
        }

        // Team Management Functions
        function openTeamModal(memberId = null) {
            const modal = document.getElementById('teamModal');
            const title = document.getElementById('teamModalTitle');
            const form = document.getElementById('teamForm');
            
            if (memberId) {
                // Edit existing member
                const member = state.team.find(m => m.id === memberId);
                if (member) {
                    title.textContent = 'Edit Team Member';
                    document.getElementById('memberId').value = member.id;
                    document.getElementById('memberName').value = member.name;
                    document.getElementById('memberRole').value = member.role;
                    document.getElementById('memberWhatsApp').value = member.whatsapp;
                    document.getElementById('projectsCount').value = member.current_projects_count;
                    document.getElementById('monthlyEarnings').value = member.monthly_earnings;
                }
            } else {
                // Add new member
                title.textContent = 'Add Team Member';
                form.reset();
                document.getElementById('memberId').value = '';
            }
            
            modal.classList.add('active');
        }

        function closeTeamModal() {
            document.getElementById('teamModal').classList.remove('active');
        }

        function saveTeamMember(e) {
            e.preventDefault();
            
            const memberId = document.getElementById('memberId').value;
            const memberData = {
                name: document.getElementById('memberName').value,
                role: document.getElementById('memberRole').value,
                whatsapp: document.getElementById('memberWhatsApp').value,
                current_projects_count: document.getElementById('projectsCount').value,
                monthly_earnings: document.getElementById('monthlyEarnings').value
            };
            
            if (memberId) {
                // Update existing member
                const index = state.team.findIndex(m => m.id === memberId);
                if (index !== -1) {
                    state.team[index] = { ...state.team[index], ...memberData };
                    showToast('Team member updated successfully!', 'success');
                    addActivity(`Team member ${memberData.name} updated`);
                }
            } else {
                // Add new member
                const newMember = {
                    id: Date.now().toString(),
                    ...memberData
                };
                state.team.push(newMember);
                showToast('Team member added successfully!', 'success');
                addActivity(`New team member ${memberData.name} added`);
            }
            
            saveData();
            closeTeamModal();
            renderTeamMembers();
            updateReassignDropdowns();
        }

        function deleteTeamMember(memberId) {
            if (confirm('Are you sure you want to delete this team member?')) {
                const member = state.team.find(m => m.id === memberId);
                
                // Check if member has assigned projects
                const assignedProjects = state.orders.filter(o => o.assigned_editor === memberId);
                if (assignedProjects.length > 0) {
                    if (!confirm(`This member has ${assignedProjects.length} assigned project(s). Do you want to proceed with deletion?`)) {
                        return;
                    }
                }
                
                state.team = state.team.filter(m => m.id !== memberId);
                
                showToast('Team member deleted successfully!', 'success');
                addActivity(`Team member ${member.name} deleted`);
                
                saveData();
                renderTeamMembers();
                updateReassignDropdowns();
            }
        }

        function reassignProjects() {
            const fromId = document.getElementById('reassignFrom').value;
            const toId = document.getElementById('reassignTo').value;
            
            if (!fromId || !toId) {
                showToast('Please select both team members', 'error');
                return;
            }
            
            if (fromId === toId) {
                showToast('Please select different team members', 'error');
                return;
            }
            
            const fromMember = state.team.find(m => m.id === fromId);
            const toMember = state.team.find(m => m.id === toId);
            
            if (!fromMember || !toMember) {
                showToast('Invalid team member selection', 'error');
                return;
            }
            
            const assignedProjects = state.orders.filter(order => order.assigned_editor === fromId);
            
            if (assignedProjects.length === 0) {
                showToast(`${fromMember.name} has no assigned projects`, 'info');
                return;
            }
            
            if (confirm(`Are you sure you want to reassign ${assignedProjects.length} project(s) from ${fromMember.name} to ${toMember.name}?`)) {
                assignedProjects.forEach(order => {
                    order.assigned_editor = toId;
                });
                
                // Update projects count
                const fromIndex = state.team.findIndex(m => m.id === fromId);
                const toIndex = state.team.findIndex(m => m.id === toId);
                
                state.team[fromIndex].current_projects_count = "0";
                state.team[toIndex].current_projects_count = (parseInt(state.team[toIndex].current_projects_count) + assignedProjects.length).toString();
                
                showToast(`Successfully reassigned ${assignedProjects.length} project(s)`, 'success');
                addActivity(`${assignedProjects.length} projects reassigned from ${fromMember.name} to ${toMember.name}`);
                
                saveData();
                renderOrdersTable();
                renderTeamMembers();
                updateKanbanBoard();
            }
        }

        // Client Management Functions
        function openClientModal(clientId = null) {
            const modal = document.getElementById('clientModal');
            const title = document.getElementById('clientModalTitle');
            const form = document.getElementById('clientForm');
            
            if (clientId) {
                // Edit existing client
                const client = state.clients.find(c => c.id === clientId);
                if (client) {
                    title.textContent = 'Edit Client';
                    document.getElementById('clientId').value = client.id;
                    document.getElementById('clientNameInput').value = client.name;
                    document.getElementById('clientWhatsAppInput').value = client.whatsapp;
                    document.getElementById('clientEmail').value = client.email || '';
                    document.getElementById('clientCompany').value = client.company || '';
                }
            } else {
                // Add new client
                title.textContent = 'Add New Client';
                form.reset();
                document.getElementById('clientId').value = '';
            }
            
            modal.classList.add('active');
        }

        function closeClientModal() {
            document.getElementById('clientModal').classList.remove('active');
        }

        function saveClient(e) {
            e.preventDefault();
            
            const clientId = document.getElementById('clientId').value;
            const clientData = {
                name: document.getElementById('clientNameInput').value,
                whatsapp: document.getElementById('clientWhatsAppInput').value,
                email: document.getElementById('clientEmail').value,
                company: document.getElementById('clientCompany').value,
                total_orders: "0",
                total_paid: "0"
            };
            
            if (clientId) {
                // Update existing client
                const index = state.clients.findIndex(c => c.id === clientId);
                if (index !== -1) {
                    state.clients[index] = { ...state.clients[index], ...clientData };
                    showToast('Client updated successfully!', 'success');
                    addActivity(`Client ${clientData.name} updated`);
                }
            } else {
                // Add new client
                const newClient = {
                    id: Date.now().toString(),
                    ...clientData
                };
                state.clients.push(newClient);
                showToast('Client added successfully!', 'success');
                addActivity(`New client ${clientData.name} added`);
            }
            
            saveData();
            closeClientModal();
            renderClientsTable();
        }

        function deleteClient(clientId) {
            if (confirm('Are you sure you want to delete this client?')) {
                const client = state.clients.find(c => c.id === clientId);
                state.clients = state.clients.filter(c => c.id !== clientId);
                
                showToast('Client deleted successfully!', 'success');
                addActivity(`Client ${client.name} deleted`);
                
                saveData();
                renderClientsTable();
            }
        }

        // Finance Functions
        function addExpense() {
            const amount = document.getElementById('expenseAmount').value;
            const description = document.getElementById('expenseDescription').value;
            
            if (!amount || !description) {
                showToast('Please enter both amount and description', 'error');
                return;
            }
            
            const expense = {
                id: Date.now().toString(),
                amount: parseFloat(amount),
                description: description,
                date: new Date().toISOString().split('T')[0],
                month: new Date().toISOString().substring(0, 7)
            };
            
            state.finances.expenses.push(expense);
            saveData();
            
            // Clear form
            document.getElementById('expenseAmount').value = '';
            document.getElementById('expenseDescription').value = '';
            
            showToast('Expense added successfully!', 'success');
            addActivity(`Expense added: ${description} - ৳${amount}`);
            
            renderExpenseList();
            updateStats();
        }

        function deleteExpense(expenseId) {
            const expenseIndex = state.finances.expenses.findIndex(expense => expense.id === expenseId);
            if (expenseIndex !== -1) {
                const expense = state.finances.expenses[expenseIndex];
                state.finances.expenses.splice(expenseIndex, 1);
                saveData();
                
                showToast('Expense deleted successfully!', 'success');
                addActivity(`Expense deleted: ${expense.description}`);
                
                renderExpenseList();
                updateStats();
            }
        }

        function exportCSV() {
            const selectedMonth = document.getElementById('financeMonthPicker').value;
            const monthOrders = state.orders.filter(order => {
                const orderDate = new Date(order.created_at);
                const orderMonth = `${orderDate.getFullYear()}-${String(orderDate.getMonth() + 1).padStart(2, '0')}`;
                return orderMonth === selectedMonth;
            });
            
            if (monthOrders.length === 0) {
                showToast('No data to export for selected month', 'info');
                return;
            }
            
            // Create CSV content
            let csvContent = 'Order No,Client Name,Project Title,Status,Editor,Price,Paid,Due Date\n';
            
            monthOrders.forEach(order => {
                const editor = state.team.find(member => member.id === order.assigned_editor);
                const editorName = editor ? editor.name : 'Unassigned';
                
                csvContent += `"${order.order_no}","${order.client_name}","${order.project_title}","${order.status}","${editorName}","${order.price}","${order.paid}","${order.due_date}"\n`;
            });
            
            // Create download link
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `motioncraft-orders-${selectedMonth}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('CSV exported successfully!', 'success');
        }

        // Activity Functions
        function addActivity(description) {
            const activity = {
                id: Date.now().toString(),
                type: 'user_action',
                description: description,
                timestamp: new Date().toISOString()
            };
            
            state.activity.unshift(activity);
            
            // Keep only last 50 activities
            if (state.activity.length > 50) {
                state.activity = state.activity.slice(0, 50);
            }
            
            saveData();
            renderRecentActivity();
            renderActivityTimeline();
        }

        function clearActivity() {
            if (confirm('Are you sure you want to clear all activity?')) {
                state.activity = [];
                saveData();
                renderRecentActivity();
                renderActivityTimeline();
                showToast('Activity cleared successfully!', 'success');
            }
        }

        // Settings Functions
        function updateSettingsUI() {
            document.getElementById('ordersEndpoint').value = state.settings.sheetDB_orders;
            document.getElementById('teamEndpoint').value = state.settings.sheetDB_team;
            document.getElementById('currencySelect').value = state.settings.currency;
            document.getElementById('themeSelect').value = state.settings.theme;
        }

        function saveEndpoints() {
            state.settings.sheetDB_orders = document.getElementById('ordersEndpoint').value;
            state.settings.sheetDB_team = document.getElementById('teamEndpoint').value;
            
            // Validate URLs
            if (state.settings.sheetDB_orders && !state.settings.sheetDB_orders.startsWith('https://sheetdb.io/api/v1/')) {
                showToast('Invalid orders endpoint format', 'error');
                return;
            }
            
            if (state.settings.sheetDB_team && !state.settings.sheetDB_team.startsWith('https://sheetdb.io/api/v1/')) {
                showToast('Invalid team endpoint format', 'error');
                return;
            }
            
            state.settings.useSheetDB = !!(state.settings.sheetDB_orders && state.settings.sheetDB_team);
            
            saveSettings();
            showToast('Endpoints saved successfully!', 'success');
        }

        async function testEndpoints() {
            showToast('Testing connections...', 'info');
            
            let ordersOk = false;
            let teamOk = false;
            
            // Test orders endpoint
            if (state.settings.sheetDB_orders) {
                try {
                    const response = await fetch(state.settings.sheetDB_orders);
                    ordersOk = response.ok;
                } catch (error) {
                    console.error('Orders endpoint test failed:', error);
                }
            }
            
            // Test team endpoint
            if (state.settings.sheetDB_team) {
                try {
                    const response = await fetch(state.settings.sheetDB_team);
                    teamOk = response.ok;
                } catch (error) {
                    console.error('Team endpoint test failed:', error);
                }
            }
            
            if (ordersOk && teamOk) {
                showToast('Both endpoints are working correctly!', 'success');
            } else if (ordersOk || teamOk) {
                showToast('One endpoint is working, but the other may have issues', 'warning');
            } else {
                showToast('Both endpoints failed. Please check your URLs', 'error');
            }
        }

        function testWhatsApp() {
            const message = document.getElementById('whatsappTest').value;
            
            if (!message) {
                showToast('Please enter a test message', 'error');
                return;
            }
            
            const encodedMessage = encodeURIComponent(message);
            const url = `https://wa.me/?text=${encodedMessage}`;
            window.open(url, '_blank');
            
            showToast('WhatsApp test launched in new tab', 'success');
        }

        function exportData() {
            const data = {
                orders: state.orders,
                team: state.team,
                clients: state.clients,
                activity: state.activity,
                finances: state.finances,
                settings: state.settings,
                export_date: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'motioncraft-backup.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Data exported successfully!', 'success');
        }

        function importData() {
            document.getElementById('fileInput').click();
        }

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const importedData = JSON.parse(event.target.result);
                    
                    if (confirm('This will replace all current data. Are you sure?')) {
                        state.orders = importedData.orders || [];
                        state.team = importedData.team || [];
                        state.clients = importedData.clients || [];
                        state.activity = importedData.activity || [];
                        state.finances = importedData.finances || { expenses: [], income: [] };
                        
                        if (importedData.settings) {
                            state.settings = { ...state.settings, ...importedData.settings };
                        }
                        
                        saveData();
                        saveSettings();
                        
                        renderAllSections();
                        updateStats();
                        showToast('Data imported successfully!', 'success');
                    }
                } catch (error) {
                    console.error('Error importing data:', error);
                    showToast('Error importing data. Invalid file format.', 'error');
                }
            };
            
            reader.readAsText(file);
            e.target.value = ''; // Reset file input
        });

        function resetData() {
            if (confirm('This will replace all current data with sample data. Are you sure?')) {
                state.orders = [...SAMPLE_DATA.orders];
                state.team = [...SAMPLE_DATA.team];
                state.clients = [...SAMPLE_DATA.clients];
                state.activity = [...SAMPLE_DATA.activity];
                state.finances.expenses = [];
                
                saveData();
                renderAllSections();
                updateStats();
                showToast('Data reset to sample data successfully!', 'success');
            }
        }

        function updateCurrency() {
            state.settings.currency = document.getElementById('currencySelect').value;
            saveSettings();
            updateCurrencyDisplay();
            updateStats();
        }

        function updateTheme() {
            state.settings.theme = document.getElementById('themeSelect').value;
            saveSettings();
            applyTheme();
        }

        function applyTheme() {
            // This is a basic implementation - you can expand this
            if (state.settings.theme === 'dark') {
                document.body.classList.add('dark');
            } else {
                document.body.classList.remove('dark');
            }
        }

        function saveSettings() {
            localStorage.setItem('motioncraft_settings', JSON.stringify(state.settings));
        }

        // Rendering Functions
        function renderAllSections() {
            renderOrdersTable();
            renderTeamMembers();
            renderClientsTable();
            renderKanbanBoard();
            renderExpenseList();
            renderRecentActivity();
            renderActivityTimeline();
            populateEditorDropdown();
            updateReassignDropdowns();
        }

        function renderOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            state.orders.forEach(order => {
                const editor = state.team.find(member => member.id === order.assigned_editor);
                const editorName = editor ? editor.name : 'Unassigned';
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200';
                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-800">${order.order_no}</td>
                    <td class="py-3 px-4 text-gray-800">${order.client_name}</td>
                    <td class="py-3 px-4 text-gray-800">${order.project_title}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium capitalize ${getStatusClass(order.status)}">
                            ${order.status.replace('_', ' ')}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-gray-800">${editorName}</td>
                    <td class="py-3 px-4 text-gray-800 currency-bdt">${parseInt(order.price).toLocaleString()}</td>
                    <td class="py-3 px-4 text-gray-800">${order.due_date}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="text-blue-600 hover:text-blue-800 edit-order" data-id="${order.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-green-600 hover:text-green-800 whatsapp-order" data-id="${order.id}">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800 delete-order" data-id="${order.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderTeamMembers() {
            const container = document.getElementById('teamContainer');
            container.innerHTML = '';
            
            state.team.forEach(member => {
                const assignedProjects = state.orders.filter(order => order.assigned_editor === member.id);
                
                const card = document.createElement('div');
                card.className = 'card glass p-6';
                card.innerHTML = `
                    <div class="flex items-center mb-4">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-r from-purple-500 to-indigo-600 flex items-center justify-center text-white font-bold text-xl">
                            ${member.name.charAt(0)}
                        </div>
                        <div class="ml-4">
                            <h3 class="text-lg font-semibold text-gray-800">${member.name}</h3>
                            <p class="text-sm text-gray-600">${member.role}</p>
                        </div>
                    </div>
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <p class="text-sm text-gray-600">Projects</p>
                            <p class="text-lg font-semibold text-gray-800">${assignedProjects.length}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600">Earnings</p>
                            <p class="text-lg font-semibold text-gray-800 currency-bdt">${parseInt(member.monthly_earnings).toLocaleString()}</p>
                        </div>
                    </div>
                    <div class="flex justify-between">
                        <a href="https://wa.me/${member.whatsapp}" target="_blank" class="text-green-600 hover:text-green-800">
                            <i class="fab fa-whatsapp text-xl"></i>
                        </a>
                        <button class="text-blue-600 hover:text-blue-800 edit-member" data-id="${member.id}">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="text-red-600 hover:text-red-800 delete-member" data-id="${member.id}">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderClientsTable() {
            const tbody = document.getElementById('clientsTableBody');
            tbody.innerHTML = '';
            
            state.clients.forEach(client => {
                const clientOrders = state.orders.filter(order => order.client_name === client.name);
                const paidOrders = clientOrders.filter(order => order.paid === 'yes');
                const totalPaid = paidOrders.reduce((sum, order) => sum + parseInt(order.price), 0);
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200';
                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-800">${client.name}</td>
                    <td class="py-3 px-4 text-gray-800">${client.whatsapp}</td>
                    <td class="py-3 px-4 text-gray-800">${clientOrders.length}</td>
                    <td class="py-3 px-4 text-gray-800 currency-bdt">${totalPaid.toLocaleString()}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <a href="https://wa.me/${client.whatsapp}" target="_blank" class="text-green-600 hover:text-green-800">
                                <i class="fab fa-whatsapp"></i>
                            </a>
                            <button class="text-blue-600 hover:text-blue-800 edit-client" data-id="${client.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800 delete-client" data-id="${client.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderKanbanBoard() {
            const statuses = ['fresh', 'scripting', 'editing', 'correction', 'final_delivery', 'completed'];
            
            statuses.forEach(status => {
                const column = document.getElementById(`${status}-column`);
                column.innerHTML = '';
                
                const statusOrders = state.orders.filter(order => order.status === status);
                
                statusOrders.forEach(order => {
                    const editor = state.team.find(member => member.id === order.assigned_editor);
                    const editorName = editor ? editor.name : 'Unassigned';
                    
                    const dueDate = new Date(order.due_date);
                    const today = new Date();
                    const timeDiff = dueDate.getTime() - today.getTime();
                    const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));
                    
                    let dueClass = 'text-green-600';
                    if (daysDiff < 0) {
                        dueClass = 'text-red-600';
                    } else if (daysDiff <= 3) {
                        dueClass = 'text-yellow-600';
                    }
                    
                    const card = document.createElement('div');
                    card.className = 'kanban-card card glass p-4';
                    card.draggable = true;
                    card.dataset.orderId = order.id;
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <span class="font-semibold text-gray-800">${order.order_no}</span>
                            <span class="text-sm font-medium ${order.paid === 'yes' ? 'text-green-600' : 'text-red-600'} currency-bdt">
                                ${parseInt(order.price).toLocaleString()}
                            </span>
                        </div>
                        <h4 class="font-medium text-gray-800 mb-1">${order.project_title}</h4>
                        <p class="text-sm text-gray-600 mb-2">${order.client_name}</p>
                        <div class="flex justify-between items-center text-sm">
                            <span class="text-gray-600">${editorName}</span>
                            <span class="${dueClass}">${daysDiff}d</span>
                        </div>
                    `;
                    
                    column.appendChild(card);
                });
            });
            
            // Re-setup drag and drop
            setupDragAndDrop();
        }

        function renderExpenseList() {
            const list = document.getElementById('expenseList');
            const financeList = document.getElementById('financeExpenseList');
            
            const selectedMonth = document.getElementById('monthPicker').value || new Date().toISOString().substring(0, 7);
            const monthExpenses = state.finances.expenses.filter(expense => expense.month === selectedMonth);
            
            list.innerHTML = '';
            financeList.innerHTML = '';
            
            if (monthExpenses.length === 0) {
                list.innerHTML = '<li class="text-gray-500 text-center py-2">No expenses for this month</li>';
                financeList.innerHTML = '<li class="text-gray-500 text-center py-2">No expenses for this month</li>';
                return;
            }
            
            monthExpenses.forEach(expense => {
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center py-2 border-b border-gray-100';
                li.innerHTML = `
                    <div>
                        <p class="text-sm text-gray-800">${expense.description}</p>
                        <p class="text-xs text-gray-500">${expense.date}</p>
                    </div>
                    <div class="flex items-center">
                        <span class="text-red-600 font-medium currency-bdt">${expense.amount.toLocaleString()}</span>
                        <button class="ml-2 text-red-600 hover:text-red-800 delete-expense" data-id="${expense.id}">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                `;
                
                list.appendChild(li.cloneNode(true));
                financeList.appendChild(li);
            });
        }

        function renderRecentActivity() {
            const container = document.getElementById('recentActivity');
            container.innerHTML = '';
            
            const recentActivities = state.activity.slice(0, 5);
            
            if (recentActivities.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No recent activity</p>';
                return;
            }
            
            recentActivities.forEach(activity => {
                const date = new Date(activity.timestamp);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <p class="text-sm text-gray-800">${activity.description}</p>
                    <p class="text-xs text-gray-500">${formattedDate}</p>
                `;
                container.appendChild(item);
            });
        }

        function renderActivityTimeline() {
            const container = document.getElementById('activityTimeline');
            container.innerHTML = '';
            
            if (state.activity.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No activity recorded yet</p>';
                return;
            }
            
            state.activity.forEach(activity => {
                const date = new Date(activity.timestamp);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                
                let icon = 'fas fa-info-circle';
                let iconColor = 'text-blue-500';
                
                if (activity.type.includes('order')) {
                    icon = 'fas fa-shopping-cart';
                    iconColor = 'text-purple-500';
                } else if (activity.type.includes('status')) {
                    icon = 'fas fa-exchange-alt';
                    iconColor = 'text-yellow-500';
                } else if (activity.type.includes('team')) {
                    icon = 'fas fa-users';
                    iconColor = 'text-green-500';
                } else if (activity.type.includes('payment')) {
                    icon = 'fas fa-money-bill-wave';
                    iconColor = 'text-green-500';
                }
                
                const item = document.createElement('div');
                item.className = 'activity-item';
                item.innerHTML = `
                    <div class="flex">
                        <div class="flex-shrink-0 mr-4">
                            <i class="${icon} ${iconColor}"></i>
                        </div>
                        <div>
                            <p class="text-sm text-gray-800">${activity.description}</p>
                            <p class="text-xs text-gray-500">${formattedDate}</p>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        function populateEditorDropdown() {
            const dropdown = document.getElementById('assignedEditor');
            const filter = document.getElementById('editorFilter');
            
            dropdown.innerHTML = '<option value="">Unassigned</option>';
            filter.innerHTML = '<option value="">All Editors</option>';
            
            state.team.forEach(member => {
                dropdown.innerHTML += `<option value="${member.id}">${member.name}</option>`;
                filter.innerHTML += `<option value="${member.id}">${member.name}</option>`;
            });
        }

        function updateReassignDropdowns() {
            const fromSelect = document.getElementById('reassignFrom');
            const toSelect = document.getElementById('reassignTo');
            
            fromSelect.innerHTML = '<option value="">Select member</option>';
            toSelect.innerHTML = '<option value="">Select member</option>';
            
            state.team.forEach(member => {
                fromSelect.innerHTML += `<option value="${member.id}">${member.name}</option>`;
                toSelect.innerHTML += `<option value="${member.id}">${member.name}</option>`;
            });
        }

        function updateStats() {
            // Total orders
            document.getElementById('totalOrders').textContent = state.orders.length;
            
            // This month orders
            const currentMonth = new Date().toISOString().substring(0, 7);
            const monthOrders = state.orders.filter(order => {
                const orderDate = new Date(order.created_at);
                const orderMonth = orderDate.toISOString().substring(0, 7);
                return orderMonth === currentMonth;
            });
            document.getElementById('monthOrders').textContent = monthOrders.length;
            
            // Paid amount
            const paidOrders = state.orders.filter(order => order.paid === 'yes');
            const totalPaid = paidOrders.reduce((sum, order) => sum + parseInt(order.price), 0);
            document.getElementById('paidAmount').textContent = totalPaid.toLocaleString();
            
            // Pending amount
            const unpaidOrders = state.orders.filter(order => order.paid === 'no');
            const totalUnpaid = unpaidOrders.reduce((sum, order) => sum + parseInt(order.price), 0);
            document.getElementById('pendingAmount').textContent = totalUnpaid.toLocaleString();
            
            // Finance section stats
            document.getElementById('financeIncome').textContent = totalPaid.toLocaleString();
            document.getElementById('financePending').textContent = totalUnpaid.toLocaleString();
            
            const totalExpenses = state.finances.expenses.reduce((sum, expense) => sum + expense.amount, 0);
            document.getElementById('financeExpenses').textContent = totalExpenses.toLocaleString();
            document.getElementById('totalExpense').textContent = totalExpenses.toLocaleString();
            
            const netIncome = totalPaid - totalExpenses;
            document.getElementById('totalIncome').textContent = netIncome.toLocaleString();
        }

        function updateCurrencyDisplay() {
            document.querySelectorAll('.currency-bdt').forEach(el => {
                if (state.settings.currency === 'bdt') {
                    el.classList.remove('currency-usd');
                    el.classList.add('currency-bdt');
                } else {
                    el.classList.remove('currency-bdt');
                    el.classList.add('currency-usd');
                }
            });
        }

        function getStatusClass(status) {
            const statusClasses = {
                fresh: 'bg-blue-100 text-blue-800',
                scripting: 'bg-yellow-100 text-yellow-800',
                editing: 'bg-purple-100 text-purple-800',
                correction: 'bg-red-100 text-red-800',
                final_delivery: 'bg-green-100 text-green-800',
                completed: 'bg-indigo-100 text-indigo-800'
            };
            
            return statusClasses[status] || 'bg-gray-100 text-gray-800';
        }

        function filterOrders() {
            const editor = document.getElementById('editorFilter').value;
            const status = document.getElementById('statusFilter').value;
            const payment = document.getElementById('paymentFilter').value;
            const search = document.getElementById('orderSearch').value.toLowerCase();
            
            const filteredOrders = state.orders.filter(order => {
                const matchesEditor = !editor || order.assigned_editor === editor;
                const matchesStatus = !status || order.status === status;
                const matchesPayment = !payment || order.paid === payment;
                const matchesSearch = !search || 
                    order.order_no.toLowerCase().includes(search) ||
                    order.client_name.toLowerCase().includes(search) ||
                    order.project_title.toLowerCase().includes(search);
                
                return matchesEditor && matchesStatus && matchesPayment && matchesSearch;
            });
            
            renderFilteredOrders(filteredOrders);
        }

        function renderFilteredOrders(orders) {
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            
            orders.forEach(order => {
                const editor = state.team.find(member => member.id === order.assigned_editor);
                const editorName = editor ? editor.name : 'Unassigned';
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-200';
                row.innerHTML = `
                    <td class="py-3 px-4 text-gray-800">${order.order_no}</td>
                    <td class="py-3 px-4 text-gray-800">${order.client_name}</td>
                    <td class="py-3 px-4 text-gray-800">${order.project_title}</td>
                    <td class="py-3 px-4">
                        <span class="px-2 py-1 rounded-full text-xs font-medium capitalize ${getStatusClass(order.status)}">
                            ${order.status.replace('_', ' ')}
                        </span>
                    </td>
                    <td class="py-3 px-4 text-gray-800">${editorName}</td>
                    <td class="py-3 px-4 text-gray-800 currency-bdt">${parseInt(order.price).toLocaleString()}</td>
                    <td class="py-3 px-4 text-gray-800">${order.due_date}</td>
                    <td class="py-3 px-4">
                        <div class="flex space-x-2">
                            <button class="text-blue-600 hover:text-blue-800 edit-order" data-id="${order.id}">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="text-green-600 hover:text-green-800 whatsapp-order" data-id="${order.id}">
                                <i class="fab fa-whatsapp"></i>
                            </button>
                            <button class="text-red-600 hover:text-red-800 delete-order" data-id="${order.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function setupDragAndDrop() {
            const cards = document.querySelectorAll('.kanban-card');
            const columns = document.querySelectorAll('.kanban-column');
            
            cards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });
            
            columns.forEach(column => {
                column.addEventListener('dragover', handleDragOver);
                column.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.setData('text/plain', e.target.dataset.orderId);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        function handleDrop(e) {
            e.preventDefault();
            const orderId = e.dataTransfer.getData('text/plain');
            const newStatus = e.target.closest('.kanban-column').dataset.status;
            
            // Update order status
            const order = state.orders.find(o => o.id === orderId);
            if (order) {
                const oldStatus = order.status;
                order.status = newStatus;
                
                showToast(`Order ${order.order_no} moved to ${newStatus}`, 'success');
                addActivity(`Order ${order.order_no} status changed from ${oldStatus} to ${newStatus}`);
                
                saveData();
                updateKanbanBoard();
            }
        }

        function openWhatsApp(phone, message) {
            const encodedMessage = encodeURIComponent(message);
            const url = `https://wa.me/${phone}?text=${encodedMessage}`;
            window.open(url, '_blank');
        }

        function initCharts() {
            // Income Chart
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');
            new Chart(incomeCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Monthly Income',
                        data: [65000, 59000, 80000, 81000, 56000, 85000],
                        backgroundColor: '#10b981',
                        borderColor: '#059669',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Finance Chart
            const financeCtx = document.getElementById('financeChart').getContext('2d');
            new Chart(financeCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [
                        {
                            label: 'Income',
                            data: [65000, 59000, 80000, 81000, 56000, 85000],
                            backgroundColor: '#10b981'
                        },
                        {
                            label: 'Expenses',
                            data: [15000, 12000, 18000, 20000, 14000, 16000],
                            backgroundColor: '#ef4444'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function showToast(message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            toast.className = `toast ${type}`;
            toastMessage.textContent = message;
            
            // Set icon based on type
            toastIcon.className = 
                type === 'success' ? 'fas fa-check-circle mr-3' :
                type === 'error' ? 'fas fa-exclamation-circle mr-3' :
                type === 'warning' ? 'fas fa-exclamation-triangle mr-3' :
                'fas fa-info-circle mr-3';
            
            toast.style.display = 'block';
            
            setTimeout(() => {
                toast.style.display = 'none';
            }, 3000);
        }
    </script>
</body>
</html>
