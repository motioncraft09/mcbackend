<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Motioncraft Owner Dashboard — Demo</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter-like font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Chart.js for dopamine-driven income chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg: #f6f7fb;
      --card: rgba(255,255,255,0.85);
      --glass: rgba(255,255,255,0.6);
      --accent1: linear-gradient(90deg,#6ee7b7,#60a5fa);
      --accent2: linear-gradient(90deg,#ffd6a5,#ff9aa2);
      --muted:#6b7280;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    /* Apple-like card */
    .glass-card{
      background: var(--card);
      backdrop-filter: blur(6px);
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(13,38,76,0.08);
    }
    .dopamine {
      background: linear-gradient(90deg,#7C3AED 0%, #06B6D4 45%, #06D6A0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .btn {
      @apply inline-flex items-center justify-center px-3 py-2 rounded-lg text-sm font-semibold shadow-sm;
    }
    /* small scroll style */
    ::-webkit-scrollbar{height:8px;width:8px}
    ::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.12);border-radius:10px}
  </style>
</head>
<body class="bg-[var(--bg)] min-h-screen text-gray-800">

  <script>
    // =========== CONFIG =============
    // Paste your Apps Script Web App base URL here (do not include trailing slash)
    const APPS_SCRIPT_BASE_URL = ''; // e.g. https://script.google.com/macros/s/XXXX/exec

    // Toggle demo mode automatically if no Apps Script URL provided
    const USE_DEMO = !APPS_SCRIPT_BASE_URL;

    // === Utility functions ===
    function waLink(number, text){
      const sanitized = String(number).replace(/\D/g,'');
      const msg = encodeURIComponent(text || 'Assalamualaikum, Motioncraft theke apnar order niye.');
      return `https://wa.me/${sanitized}?text=${msg}`;
    }

    function formatBDT(n){
      return '৳' + (Number(n)||0).toLocaleString('en-US');
    }

    function dateYMD(d){
      if(!d) return '';
      const dt = new Date(d);
      if(isNaN(dt)) return d;
      return dt.toISOString().slice(0,10);
    }

    // ============ Sample demo data ============
    const SAMPLE_ORDERS = [
      {id:'1',order_no:'MC-2025-001',client_name:'Rahim Uddin',client_whatsapp:'8801712345689',project_title:'Furniture Promo Video',status:'fresh',assigned_editor:'Siam',price:18000,paid:'no',created_at:'2025-11-01',due_date:'2025-11-05',notes:'Urgent delivery required',internal_comments:'Script needed'},
      {id:'2',order_no:'MC-2025-002',client_name:'Mehnaz Beauty Parlour',client_whatsapp:'8801902341123',project_title:'Salon Branding Reel',status:'editing',assigned_editor:'Mojid',price:12500,paid:'yes',created_at:'2025-11-03',due_date:'2025-11-08',notes:'Soft color grading',internal_comments:'Ref videos available'},
      {id:'3',order_no:'MC-2025-003',client_name:'Hasan Mobile Shop',client_whatsapp:'8801817789044',project_title:'Smartphone Feature Ad',status:'scripting',assigned_editor:'Samiul',price:9000,paid:'no',created_at:'2025-11-02',due_date:'2025-11-06',notes:'Bangla subtitles',internal_comments:'Draft approved'},
      {id:'4',order_no:'MC-2025-004',client_name:'GreenLeaf Organic',client_whatsapp:'8801789904321',project_title:'Organic Product Promo',status:'final_delivery',assigned_editor:'Hojayfa',price:14000,paid:'yes',created_at:'2025-10-29',due_date:'2025-11-02',notes:'Add logo animation',internal_comments:'Color correction pending'},
      {id:'5',order_no:'MC-2025-005',client_name:'City Gym Dhaka',client_whatsapp:'8801911123456',project_title:'Fitness Motivation Reel',status:'correction',assigned_editor:'Siam',price:11000,paid:'no',created_at:'2025-11-04',due_date:'2025-11-07',notes:'Cut 5s end',internal_comments:'Client reviewing 2nd draft'}
    ];

    const SAMPLE_TEAM = [
      {member_id:'1',name:'Siam',role:'Editor',whatsapp:'8801711111111',current_projects_count:2,monthly_earnings:30000},
      {member_id:'2',name:'Mojid',role:'Editor',whatsapp:'8801712222222',current_projects_count:1,monthly_earnings:12000},
      {member_id:'3',name:'Samiul',role:'Editor',whatsapp:'8801713333333',current_projects_count:1,monthly_earnings:9000},
    ];

    // ============ State ============
    let ORDERS = [];
    let TEAM = [];
    let FINANCE = []; // optional
    let selectedMonth = (new Date()).toISOString().slice(0,7); // YYYY-MM

    // ============ API helpers (Apps Script) ============
    async function apiGET(route){
      if(USE_DEMO){
        if(route === 'orders') return {ok:true, data: SAMPLE_ORDERS};
        if(route === 'team') return {ok:true, data: SAMPLE_TEAM};
        return {ok:true, data:[]};
      }
      try {
        const url = `${APPS_SCRIPT_BASE_URL}?route=${route}`;
        const res = await fetch(url);
        return await res.json();
      } catch(err){
        return {ok:false, error:String(err)};
      }
    }

    async function apiPOST(route, payload){
      if(USE_DEMO){
        // simulate success
        return {ok:true, msg:'demo ok'};
      }
      try {
        const url = `${APPS_SCRIPT_BASE_URL}?route=${route}`;
        const res = await fetch(url, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        return await res.json();
      } catch(err){
        return {ok:false, error:String(err)};
      }
    }

    // ============ Load data ============
    async function loadAll(){
      showLoader(true);
      const [ordersRes, teamRes, financeRes] = await Promise.all([
        apiGET('orders'),
        apiGET('team'),
        apiGET('finance')
      ]);
      ORDERS = (ordersRes && ordersRes.ok) ? ordersRes.data.slice() : [];
      TEAM = (teamRes && teamRes.ok) ? teamRes.data.slice() : [];
      FINANCE = (financeRes && financeRes.ok) ? financeRes.data.slice() : [];
      // normalize types
      ORDERS = ORDERS.map(o => ({...o, price: Number(o.price||0)}));
      renderAll();
      showLoader(false);
    }

    // ============ Render UI ============
    function renderAll(){
      renderSummary();
      renderOrdersTable();
      renderTeamPanel();
      renderIncomeChart();
      renderClients();
    }

    // Summary cards
    function renderSummary(){
      const totalOrders = ORDERS.length;
      const monthOrders = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth)).length;
      const paidThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && (String(o.paid).toLowerCase()==='yes')).reduce((s,x)=>s+Number(x.price||0),0);
      const pendingThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && (String(o.paid||'no').toLowerCase()!=='yes')).reduce((s,x)=>s+Number(x.price||0),0);

      document.getElementById('summary-cards').innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Total Orders</div>
            <div class="text-2xl font-bold">${totalOrders}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Orders (${selectedMonth})</div>
            <div class="text-2xl font-bold">${monthOrders}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Paid (${selectedMonth})</div>
            <div class="text-2xl font-bold dopamine">${formatBDT(paidThisMonth)}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Pending (${selectedMonth})</div>
            <div class="text-2xl font-bold">${formatBDT(pendingThisMonth)}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Total Income</div>
            <div class="text-2xl font-bold">${formatBDT(ORDERS.reduce((s,x)=>s+Number(x.price||0),0))}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Selected Month</div>
            <div class="flex items-center gap-2">
              <input id="monthPicker" type="month" value="${selectedMonth}" class="p-2 rounded-lg border bg-white"/>
            </div>
          </div>
        </div>
      `;
      document.getElementById('monthPicker').addEventListener('change', e=>{
        selectedMonth = e.target.value;
        renderAll();
      });
    }

    // Orders table
    function renderOrdersTable(){
      const rows = ORDERS.map(o=>`
        <tr class="align-top border-b">
          <td class="py-3 px-2 text-sm">${o.order_no||''}</td>
          <td class="py-3 px-2 text-sm">${o.client_name||''}</td>
          <td class="py-3 px-2 text-sm">${o.project_title||''}</td>
          <td class="py-3 px-2 text-sm">${o.assigned_editor||''}</td>
          <td class="py-3 px-2 text-sm">${o.status||''}</td>
          <td class="py-3 px-2 text-sm">${formatBDT(o.price||0)}</td>
          <td class="py-3 px-2 text-sm">${(String(o.paid||'no').toLowerCase()==='yes')?'<span class=\"text-green-600 font-semibold\">Paid</span>':'<span class=\"text-yellow-600 font-semibold\">Unpaid</span>'}</td>
          <td class="py-3 px-2 text-sm">
            <button class="btn bg-white border mr-1" onclick="openDetail('${o.id||''}')">Details</button>
            <button class="btn bg-white border mr-1" onclick="openWhatsApp('${o.client_whatsapp||''}','${o.client_name||''}','${o.order_no||''}')">WhatsApp</button>
          </td>
        </tr>
      `).join('');
      document.getElementById('orders-table-body').innerHTML = rows;
    }

    window.openWhatsApp = function(number, name, order_no){
      const url = waLink(number, `Assalamualaikum ${name}, Motioncraft theke apnar order ${order_no} niye.`);
      window.open(url,'_blank');
    }

    // Order detail modal
    window.openDetail = function(id){
      const o = ORDERS.find(x=>String(x.id)===String(id));
      if(!o) return alert('Order not found');
      const modal = document.getElementById('detail-modal');
      document.getElementById('detail-order-no').innerText = o.order_no||'';
      document.getElementById('detail-client-name').value = o.client_name||'';
      document.getElementById('detail-project-title').value = o.project_title||'';
      document.getElementById('detail-price').value = o.price||'';
      document.getElementById('detail-status').value = o.status||'fresh';
      document.getElementById('detail-assigned').value = o.assigned_editor||'';
      document.getElementById('detail-paid').checked = String(o.paid).toLowerCase()==='yes';
      document.getElementById('detail-notes').value = o.notes||'';
      document.getElementById('detail-internal').value = o.internal_comments||'';
      document.getElementById('detail-save-btn').onclick = async function(){
        const updated = {
          id: o.id,
          order_no: document.getElementById('detail-order-no').innerText,
          client_name: document.getElementById('detail-client-name').value,
          project_title: document.getElementById('detail-project-title').value,
          price: Number(document.getElementById('detail-price').value||0),
          status: document.getElementById('detail-status').value,
          assigned_editor: document.getElementById('detail-assigned').value,
          paid: document.getElementById('detail-paid').checked ? 'yes' : 'no',
          notes: document.getElementById('detail-notes').value,
          internal_comments: document.getElementById('detail-internal').value
        };
        showLoader(true);
        const res = await apiPOST('orders_update', updated);
        if(res && res.ok){
          // update local demo or reload
          if(USE_DEMO){
            const idx = ORDERS.findIndex(x=>String(x.id)===String(o.id));
            if(idx>-1) ORDERS[idx] = {...ORDERS[idx], ...updated};
            renderAll();
            showLoader(false);
            closeModal();
            toast('Saved (demo)');
          } else {
            await loadAll();
            closeModal();
            toast('Saved');
          }
        } else {
          showLoader(false);
          alert('Error: '+(res && res.error || JSON.stringify(res)));
        }
      };
      modal.classList.remove('hidden');
    }

    function closeModal(){
      document.getElementById('detail-modal').classList.add('hidden');
    }

    // Team panel
    function renderTeamPanel(){
      const html = TEAM.map(m=>`
        <div class="glass-card p-4">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-indigo-400 to-cyan-300 flex items-center justify-center text-white font-bold">${m.name.charAt(0)||'U'}</div>
            <div>
              <div class="font-semibold">${m.name}</div>
              <div class="text-xs text-${'var(--muted)'}">${m.role}</div>
            </div>
          </div>
          <div class="mt-3 grid grid-cols-3 gap-2 text-sm">
            <div><div class="text-xs text-${'var(--muted)'}">Projects</div><div class="font-bold">${m.current_projects_count||0}</div></div>
            <div><div class="text-xs text-${'var(--muted)'}">Earnings</div><div class="font-bold">${formatBDT(m.monthly_earnings||0)}</div></div>
            <div><div class="text-xs text-${'var(--muted)'}">Contact</div><div><button class="btn bg-white border text-sm" onclick="window.open('${waLink(m.whatsapp, 'Hello '+m.name)}','_blank')">WhatsApp</button></div></div>
          </div>
        </div>
      `).join('');
      document.getElementById('team-grid').innerHTML = html;
    }

    // Clients (aggregate)
    function renderClients(){
      const grouped = {};
      ORDERS.forEach(o=>{
        const key = o.client_name || 'Unknown';
        if(!grouped[key]) grouped[key] = {name:key,whatsapp:o.client_whatsapp,orders:[],paid:0,pending:0,total:0};
        grouped[key].orders.push(o);
        grouped[key].total += Number(o.price||0);
        if(String(o.paid).toLowerCase()==='yes') grouped[key].paid += Number(o.price||0);
        else grouped[key].pending += Number(o.price||0);
      });
      const html = Object.values(grouped).map(c=>`
        <div class="glass-card p-3 flex justify-between items-center">
          <div>
            <div class="font-semibold">${c.name}</div>
            <div class="text-sm text-${'var(--muted)'}">${c.orders.length} projects • ${formatBDT(c.total)}</div>
          </div>
          <div class="flex gap-2">
            <button class="btn bg-white border" onclick="window.open('${waLink(c.whatsapp, 'Assalamualaikum '+c.name)}','_blank')">WhatsApp</button>
            <button class="btn bg-white border" onclick="openClientOrders('${c.name.replace(/'/g, "\\'")}')">View</button>
          </div>
        </div>
      `).join('');
      document.getElementById('clients-list').innerHTML = html;
    }

    window.openClientOrders = function(name){
      const list = ORDERS.filter(o=>o.client_name===name);
      const rows = list.map(o=>`<li class="py-1">${o.order_no} — ${o.project_title} — ${formatBDT(o.price)}</li>`).join('');
      alert(`Orders for ${name}:\n\n` + list.map(x=>`${x.order_no} — ${x.project_title} — ${formatBDT(x.price)} — ${x.status}`).join('\n'));
    }

    // Income chart (dopamine-driven)
    let incomeChart = null;
    function renderIncomeChart(){
      const paidThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && String(o.paid).toLowerCase()==='yes').reduce((s,x)=>s+Number(x.price||0),0);
      const pendingThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && String(o.paid||'no').toLowerCase()!=='yes').reduce((s,x)=>s+Number(x.price||0),0);
      const total = paidThisMonth + pendingThisMonth;
      document.getElementById('income-numbers').innerHTML = `
        <div class="text-sm text-${'var(--muted)'}">Paid</div>
        <div class="text-2xl font-bold dopamine">${formatBDT(paidThisMonth)}</div>
        <div class="text-sm text-${'var(--muted)'}">Pending</div>
        <div class="text-2xl font-bold">${formatBDT(pendingThisMonth)}</div>
      `;
      const ctx = document.getElementById('incomeChart').getContext('2d');
      if(incomeChart) incomeChart.destroy();
      incomeChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Paid','Pending'],
          datasets: [{
            data: [paidThisMonth || 0, pendingThisMonth || 0],
            backgroundColor: [
              'rgba(124,58,237,0.95)', // vivid purple
              'rgba(6,182,212,0.95)'   // cyan
            ],
            borderWidth: 0
          }]
        },
        options: {
          cutout: '70%',
          plugins: {
            legend: { display: false},
            tooltip: {
              callbacks: {
                label: function(context){
                  const v = context.parsed || 0;
                  return `${context.label}: ${formatBDT(v)}`;
                }
              }
            }
          }
        }
      });
    }

    // Loader & Toast
    function showLoader(show){
      document.getElementById('loader').style.display = show ? 'flex' : 'none';
    }
    function toast(msg){
      const el = document.createElement('div');
      el.className = 'fixed bottom-6 right-6 glass-card p-3 shadow-lg animate-slide-in';
      el.innerText = msg;
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 3000);
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', async ()=>{
      if(USE_DEMO) {
        ORDERS = SAMPLE_ORDERS.slice();
        TEAM = SAMPLE_TEAM.slice();
        renderAll();
      } else {
        await loadAll();
      }
    });
  </script>

  <!-- ========== UI ========== -->
  <div class="max-w-7xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl bg-white shadow flex items-center justify-center text-2xl font-bold">M</div>
        <div>
          <div class="text-sm text-gray-500">Motioncraft</div>
          <div class="text-xl font-semibold">Owner Dashboard</div>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-sm text-gray-600">Demo: <span class="font-medium">${USE_DEMO ? 'ON' : 'OFF'}</span></div>
        <div class="glass-card p-2 rounded-lg"> <button class="btn" onclick="location.reload()">Refresh</button></div>
      </div>
    </header>

    <!-- Summary -->
    <section id="summary-cards" class="mb-6"></section>

    <div class="grid md:grid-cols-3 gap-4">
      <!-- Left: Orders -->
      <div class="md:col-span-2 space-y-4">
        <div class="glass-card p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="font-semibold">Orders</div>
            <div class="flex gap-2">
              <button class="btn bg-white border" onclick="alert('Add order flow not implemented in demo')">+ Add Order</button>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full text-left">
              <thead class="text-sm text-gray-500">
                <tr>
                  <th class="py-2 px-2">Order</th>
                  <th class="py-2 px-2">Client</th>
                  <th class="py-2 px-2">Project</th>
                  <th class="py-2 px-2">Editor</th>
                  <th class="py-2 px-2">Status</th>
                  <th class="py-2 px-2">Price</th>
                  <th class="py-2 px-2">Paid</th>
                  <th class="py-2 px-2">Actions</th>
                </tr>
              </thead>
              <tbody id="orders-table-body" class="text-sm"></tbody>
            </table>
          </div>
        </div>

        <!-- Clients -->
        <div class="glass-card p-4">
          <div class="font-semibold mb-3">Clients</div>
          <div id="clients-list" class="grid gap-3"></div>
        </div>
      </div>

      <!-- Right: Team + Income -->
      <aside class="space-y-4">
        <div class="glass-card p-4">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Team</div>
            <div class="text-sm text-gray-500">Overview</div>
          </div>
          <div id="team-grid" class="mt-3 grid gap-3"></div>
        </div>

        <div class="glass-card p-4">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Income (Dopamine Chart)</div>
            <div class="text-sm text-gray-500">${selectedMonth}</div>
          </div>
          <div class="mt-3 flex items-center gap-4">
            <canvas id="incomeChart" width="180" height="180"></canvas>
            <div id="income-numbers"></div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Loader -->
    <div id="loader" style="display:none" class="fixed inset-0 bg-black/10 backdrop-blur z-50 flex items-center justify-center">
      <div class="glass-card p-4 flex items-center gap-3">
        <div class="loader w-8 h-8 border-4 border-t-transparent rounded-full animate-spin"></div>
        <div>Loading...</div>
      </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 bg-black/30 hidden items-center justify-center z-50 p-4">
      <div class="w-full max-w-2xl glass-card p-6 relative">
        <button onclick="closeModal()" class="absolute right-4 top-4 text-gray-600">✕</button>
        <div class="text-lg font-semibold mb-3">Order Detail — <span id="detail-order-no"></span></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input id="detail-client-name" class="p-2 rounded border" placeholder="Client name"/>
          <input id="detail-project-title" class="p-2 rounded border" placeholder="Project title"/>
          <input id="detail-price" class="p-2 rounded border" placeholder="Price"/>
          <select id="detail-status" class="p-2 rounded border">
            <option value="fresh">Fresh</option>
            <option value="scripting">Scripting</option>
            <option value="editing">Editing</option>
            <option value="correction">Correction</option>
            <option value="final_delivery">Final Delivery</option>
            <option value="completed">Completed</option>
          </select>
          <select id="detail-assigned" class="p-2 rounded border">
            <option>Siam</option><option>Mojid</option><option>Samiul</option><option>Hojayfa</option>
          </select>
          <label class="flex items-center gap-2"><input id="detail-paid" type="checkbox"/> Paid</label>
          <textarea id="detail-notes" class="p-2 rounded border col-span-2" placeholder="Notes"></textarea>
          <textarea id="detail-internal" class="p-2 rounded border col-span-2" placeholder="Internal comments"></textarea>
        </div>
        <div class="mt-4 text-right">
          <button id="detail-save-btn" class="btn bg-indigo-600 text-white px-4 py-2 rounded">Save</button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-8 text-sm text-gray-500">
      Built for Motioncraft — demo mode: <strong>${USE_DEMO ? 'ON' : 'OFF'}</strong>. Replace APPS_SCRIPT_BASE_URL in the top of the file with your Apps Script Web App URL to connect real Google Sheet data.
    </footer>
  </div>

</body>
</html>
<!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Motioncraft Owner Dashboard — Demo</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter-like font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">

  <!-- Chart.js for dopamine-driven income chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    :root{
      --bg: #f6f7fb;
      --card: rgba(255,255,255,0.85);
      --glass: rgba(255,255,255,0.6);
      --accent1: linear-gradient(90deg,#6ee7b7,#60a5fa);
      --accent2: linear-gradient(90deg,#ffd6a5,#ff9aa2);
      --muted:#6b7280;
      font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    /* Apple-like card */
    .glass-card{
      background: var(--card);
      backdrop-filter: blur(6px);
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(13,38,76,0.08);
    }
    .dopamine {
      background: linear-gradient(90deg,#7C3AED 0%, #06B6D4 45%, #06D6A0 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .btn {
      @apply inline-flex items-center justify-center px-3 py-2 rounded-lg text-sm font-semibold shadow-sm;
    }
    /* small scroll style */
    ::-webkit-scrollbar{height:8px;width:8px}
    ::-webkit-scrollbar-thumb{background:rgba(0,0,0,0.12);border-radius:10px}
  </style>
</head>
<body class="bg-[var(--bg)] min-h-screen text-gray-800">

  <script>
    // =========== CONFIG =============
    // Paste your Apps Script Web App base URL here (do not include trailing slash)
    const APPS_SCRIPT_BASE_URL = ''; // e.g. https://script.google.com/macros/s/XXXX/exec

    // Toggle demo mode automatically if no Apps Script URL provided
    const USE_DEMO = !APPS_SCRIPT_BASE_URL;

    // === Utility functions ===
    function waLink(number, text){
      const sanitized = String(number).replace(/\D/g,'');
      const msg = encodeURIComponent(text || 'Assalamualaikum, Motioncraft theke apnar order niye.');
      return `https://wa.me/${sanitized}?text=${msg}`;
    }

    function formatBDT(n){
      return '৳' + (Number(n)||0).toLocaleString('en-US');
    }

    function dateYMD(d){
      if(!d) return '';
      const dt = new Date(d);
      if(isNaN(dt)) return d;
      return dt.toISOString().slice(0,10);
    }

    // ============ Sample demo data ============
    const SAMPLE_ORDERS = [
      {id:'1',order_no:'MC-2025-001',client_name:'Rahim Uddin',client_whatsapp:'8801712345689',project_title:'Furniture Promo Video',status:'fresh',assigned_editor:'Siam',price:18000,paid:'no',created_at:'2025-11-01',due_date:'2025-11-05',notes:'Urgent delivery required',internal_comments:'Script needed'},
      {id:'2',order_no:'MC-2025-002',client_name:'Mehnaz Beauty Parlour',client_whatsapp:'8801902341123',project_title:'Salon Branding Reel',status:'editing',assigned_editor:'Mojid',price:12500,paid:'yes',created_at:'2025-11-03',due_date:'2025-11-08',notes:'Soft color grading',internal_comments:'Ref videos available'},
      {id:'3',order_no:'MC-2025-003',client_name:'Hasan Mobile Shop',client_whatsapp:'8801817789044',project_title:'Smartphone Feature Ad',status:'scripting',assigned_editor:'Samiul',price:9000,paid:'no',created_at:'2025-11-02',due_date:'2025-11-06',notes:'Bangla subtitles',internal_comments:'Draft approved'},
      {id:'4',order_no:'MC-2025-004',client_name:'GreenLeaf Organic',client_whatsapp:'8801789904321',project_title:'Organic Product Promo',status:'final_delivery',assigned_editor:'Hojayfa',price:14000,paid:'yes',created_at:'2025-10-29',due_date:'2025-11-02',notes:'Add logo animation',internal_comments:'Color correction pending'},
      {id:'5',order_no:'MC-2025-005',client_name:'City Gym Dhaka',client_whatsapp:'8801911123456',project_title:'Fitness Motivation Reel',status:'correction',assigned_editor:'Siam',price:11000,paid:'no',created_at:'2025-11-04',due_date:'2025-11-07',notes:'Cut 5s end',internal_comments:'Client reviewing 2nd draft'}
    ];

    const SAMPLE_TEAM = [
      {member_id:'1',name:'Siam',role:'Editor',whatsapp:'8801711111111',current_projects_count:2,monthly_earnings:30000},
      {member_id:'2',name:'Mojid',role:'Editor',whatsapp:'8801712222222',current_projects_count:1,monthly_earnings:12000},
      {member_id:'3',name:'Samiul',role:'Editor',whatsapp:'8801713333333',current_projects_count:1,monthly_earnings:9000},
    ];

    // ============ State ============
    let ORDERS = [];
    let TEAM = [];
    let FINANCE = []; // optional
    let selectedMonth = (new Date()).toISOString().slice(0,7); // YYYY-MM

    // ============ API helpers (Apps Script) ============
    async function apiGET(route){
      if(USE_DEMO){
        if(route === 'orders') return {ok:true, data: SAMPLE_ORDERS};
        if(route === 'team') return {ok:true, data: SAMPLE_TEAM};
        return {ok:true, data:[]};
      }
      try {
        const url = `${APPS_SCRIPT_BASE_URL}?route=${route}`;
        const res = await fetch(url);
        return await res.json();
      } catch(err){
        return {ok:false, error:String(err)};
      }
    }

    async function apiPOST(route, payload){
      if(USE_DEMO){
        // simulate success
        return {ok:true, msg:'demo ok'};
      }
      try {
        const url = `${APPS_SCRIPT_BASE_URL}?route=${route}`;
        const res = await fetch(url, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        return await res.json();
      } catch(err){
        return {ok:false, error:String(err)};
      }
    }

    // ============ Load data ============
    async function loadAll(){
      showLoader(true);
      const [ordersRes, teamRes, financeRes] = await Promise.all([
        apiGET('orders'),
        apiGET('team'),
        apiGET('finance')
      ]);
      ORDERS = (ordersRes && ordersRes.ok) ? ordersRes.data.slice() : [];
      TEAM = (teamRes && teamRes.ok) ? teamRes.data.slice() : [];
      FINANCE = (financeRes && financeRes.ok) ? financeRes.data.slice() : [];
      // normalize types
      ORDERS = ORDERS.map(o => ({...o, price: Number(o.price||0)}));
      renderAll();
      showLoader(false);
    }

    // ============ Render UI ============
    function renderAll(){
      renderSummary();
      renderOrdersTable();
      renderTeamPanel();
      renderIncomeChart();
      renderClients();
    }

    // Summary cards
    function renderSummary(){
      const totalOrders = ORDERS.length;
      const monthOrders = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth)).length;
      const paidThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && (String(o.paid).toLowerCase()==='yes')).reduce((s,x)=>s+Number(x.price||0),0);
      const pendingThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && (String(o.paid||'no').toLowerCase()!=='yes')).reduce((s,x)=>s+Number(x.price||0),0);

      document.getElementById('summary-cards').innerHTML = `
        <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4">
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Total Orders</div>
            <div class="text-2xl font-bold">${totalOrders}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Orders (${selectedMonth})</div>
            <div class="text-2xl font-bold">${monthOrders}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Paid (${selectedMonth})</div>
            <div class="text-2xl font-bold dopamine">${formatBDT(paidThisMonth)}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Pending (${selectedMonth})</div>
            <div class="text-2xl font-bold">${formatBDT(pendingThisMonth)}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Total Income</div>
            <div class="text-2xl font-bold">${formatBDT(ORDERS.reduce((s,x)=>s+Number(x.price||0),0))}</div>
          </div>
          <div class="glass-card p-4">
            <div class="text-xs text-${'var(--muted)'}">Selected Month</div>
            <div class="flex items-center gap-2">
              <input id="monthPicker" type="month" value="${selectedMonth}" class="p-2 rounded-lg border bg-white"/>
            </div>
          </div>
        </div>
      `;
      document.getElementById('monthPicker').addEventListener('change', e=>{
        selectedMonth = e.target.value;
        renderAll();
      });
    }

    // Orders table
    function renderOrdersTable(){
      const rows = ORDERS.map(o=>`
        <tr class="align-top border-b">
          <td class="py-3 px-2 text-sm">${o.order_no||''}</td>
          <td class="py-3 px-2 text-sm">${o.client_name||''}</td>
          <td class="py-3 px-2 text-sm">${o.project_title||''}</td>
          <td class="py-3 px-2 text-sm">${o.assigned_editor||''}</td>
          <td class="py-3 px-2 text-sm">${o.status||''}</td>
          <td class="py-3 px-2 text-sm">${formatBDT(o.price||0)}</td>
          <td class="py-3 px-2 text-sm">${(String(o.paid||'no').toLowerCase()==='yes')?'<span class=\"text-green-600 font-semibold\">Paid</span>':'<span class=\"text-yellow-600 font-semibold\">Unpaid</span>'}</td>
          <td class="py-3 px-2 text-sm">
            <button class="btn bg-white border mr-1" onclick="openDetail('${o.id||''}')">Details</button>
            <button class="btn bg-white border mr-1" onclick="openWhatsApp('${o.client_whatsapp||''}','${o.client_name||''}','${o.order_no||''}')">WhatsApp</button>
          </td>
        </tr>
      `).join('');
      document.getElementById('orders-table-body').innerHTML = rows;
    }

    window.openWhatsApp = function(number, name, order_no){
      const url = waLink(number, `Assalamualaikum ${name}, Motioncraft theke apnar order ${order_no} niye.`);
      window.open(url,'_blank');
    }

    // Order detail modal
    window.openDetail = function(id){
      const o = ORDERS.find(x=>String(x.id)===String(id));
      if(!o) return alert('Order not found');
      const modal = document.getElementById('detail-modal');
      document.getElementById('detail-order-no').innerText = o.order_no||'';
      document.getElementById('detail-client-name').value = o.client_name||'';
      document.getElementById('detail-project-title').value = o.project_title||'';
      document.getElementById('detail-price').value = o.price||'';
      document.getElementById('detail-status').value = o.status||'fresh';
      document.getElementById('detail-assigned').value = o.assigned_editor||'';
      document.getElementById('detail-paid').checked = String(o.paid).toLowerCase()==='yes';
      document.getElementById('detail-notes').value = o.notes||'';
      document.getElementById('detail-internal').value = o.internal_comments||'';
      document.getElementById('detail-save-btn').onclick = async function(){
        const updated = {
          id: o.id,
          order_no: document.getElementById('detail-order-no').innerText,
          client_name: document.getElementById('detail-client-name').value,
          project_title: document.getElementById('detail-project-title').value,
          price: Number(document.getElementById('detail-price').value||0),
          status: document.getElementById('detail-status').value,
          assigned_editor: document.getElementById('detail-assigned').value,
          paid: document.getElementById('detail-paid').checked ? 'yes' : 'no',
          notes: document.getElementById('detail-notes').value,
          internal_comments: document.getElementById('detail-internal').value
        };
        showLoader(true);
        const res = await apiPOST('orders_update', updated);
        if(res && res.ok){
          // update local demo or reload
          if(USE_DEMO){
            const idx = ORDERS.findIndex(x=>String(x.id)===String(o.id));
            if(idx>-1) ORDERS[idx] = {...ORDERS[idx], ...updated};
            renderAll();
            showLoader(false);
            closeModal();
            toast('Saved (demo)');
          } else {
            await loadAll();
            closeModal();
            toast('Saved');
          }
        } else {
          showLoader(false);
          alert('Error: '+(res && res.error || JSON.stringify(res)));
        }
      };
      modal.classList.remove('hidden');
    }

    function closeModal(){
      document.getElementById('detail-modal').classList.add('hidden');
    }

    // Team panel
    function renderTeamPanel(){
      const html = TEAM.map(m=>`
        <div class="glass-card p-4">
          <div class="flex items-center gap-3">
            <div class="w-12 h-12 rounded-full bg-gradient-to-tr from-indigo-400 to-cyan-300 flex items-center justify-center text-white font-bold">${m.name.charAt(0)||'U'}</div>
            <div>
              <div class="font-semibold">${m.name}</div>
              <div class="text-xs text-${'var(--muted)'}">${m.role}</div>
            </div>
          </div>
          <div class="mt-3 grid grid-cols-3 gap-2 text-sm">
            <div><div class="text-xs text-${'var(--muted)'}">Projects</div><div class="font-bold">${m.current_projects_count||0}</div></div>
            <div><div class="text-xs text-${'var(--muted)'}">Earnings</div><div class="font-bold">${formatBDT(m.monthly_earnings||0)}</div></div>
            <div><div class="text-xs text-${'var(--muted)'}">Contact</div><div><button class="btn bg-white border text-sm" onclick="window.open('${waLink(m.whatsapp, 'Hello '+m.name)}','_blank')">WhatsApp</button></div></div>
          </div>
        </div>
      `).join('');
      document.getElementById('team-grid').innerHTML = html;
    }

    // Clients (aggregate)
    function renderClients(){
      const grouped = {};
      ORDERS.forEach(o=>{
        const key = o.client_name || 'Unknown';
        if(!grouped[key]) grouped[key] = {name:key,whatsapp:o.client_whatsapp,orders:[],paid:0,pending:0,total:0};
        grouped[key].orders.push(o);
        grouped[key].total += Number(o.price||0);
        if(String(o.paid).toLowerCase()==='yes') grouped[key].paid += Number(o.price||0);
        else grouped[key].pending += Number(o.price||0);
      });
      const html = Object.values(grouped).map(c=>`
        <div class="glass-card p-3 flex justify-between items-center">
          <div>
            <div class="font-semibold">${c.name}</div>
            <div class="text-sm text-${'var(--muted)'}">${c.orders.length} projects • ${formatBDT(c.total)}</div>
          </div>
          <div class="flex gap-2">
            <button class="btn bg-white border" onclick="window.open('${waLink(c.whatsapp, 'Assalamualaikum '+c.name)}','_blank')">WhatsApp</button>
            <button class="btn bg-white border" onclick="openClientOrders('${c.name.replace(/'/g, "\\'")}')">View</button>
          </div>
        </div>
      `).join('');
      document.getElementById('clients-list').innerHTML = html;
    }

    window.openClientOrders = function(name){
      const list = ORDERS.filter(o=>o.client_name===name);
      const rows = list.map(o=>`<li class="py-1">${o.order_no} — ${o.project_title} — ${formatBDT(o.price)}</li>`).join('');
      alert(`Orders for ${name}:\n\n` + list.map(x=>`${x.order_no} — ${x.project_title} — ${formatBDT(x.price)} — ${x.status}`).join('\n'));
    }

    // Income chart (dopamine-driven)
    let incomeChart = null;
    function renderIncomeChart(){
      const paidThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && String(o.paid).toLowerCase()==='yes').reduce((s,x)=>s+Number(x.price||0),0);
      const pendingThisMonth = ORDERS.filter(o => (o.created_at||'').startsWith(selectedMonth) && String(o.paid||'no').toLowerCase()!=='yes').reduce((s,x)=>s+Number(x.price||0),0);
      const total = paidThisMonth + pendingThisMonth;
      document.getElementById('income-numbers').innerHTML = `
        <div class="text-sm text-${'var(--muted)'}">Paid</div>
        <div class="text-2xl font-bold dopamine">${formatBDT(paidThisMonth)}</div>
        <div class="text-sm text-${'var(--muted)'}">Pending</div>
        <div class="text-2xl font-bold">${formatBDT(pendingThisMonth)}</div>
      `;
      const ctx = document.getElementById('incomeChart').getContext('2d');
      if(incomeChart) incomeChart.destroy();
      incomeChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Paid','Pending'],
          datasets: [{
            data: [paidThisMonth || 0, pendingThisMonth || 0],
            backgroundColor: [
              'rgba(124,58,237,0.95)', // vivid purple
              'rgba(6,182,212,0.95)'   // cyan
            ],
            borderWidth: 0
          }]
        },
        options: {
          cutout: '70%',
          plugins: {
            legend: { display: false},
            tooltip: {
              callbacks: {
                label: function(context){
                  const v = context.parsed || 0;
                  return `${context.label}: ${formatBDT(v)}`;
                }
              }
            }
          }
        }
      });
    }

    // Loader & Toast
    function showLoader(show){
      document.getElementById('loader').style.display = show ? 'flex' : 'none';
    }
    function toast(msg){
      const el = document.createElement('div');
      el.className = 'fixed bottom-6 right-6 glass-card p-3 shadow-lg animate-slide-in';
      el.innerText = msg;
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 3000);
    }

    // Initial load
    document.addEventListener('DOMContentLoaded', async ()=>{
      if(USE_DEMO) {
        ORDERS = SAMPLE_ORDERS.slice();
        TEAM = SAMPLE_TEAM.slice();
        renderAll();
      } else {
        await loadAll();
      }
    });
  </script>

  <!-- ========== UI ========== -->
  <div class="max-w-7xl mx-auto p-6">
    <header class="flex items-center justify-between mb-6">
      <div class="flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl bg-white shadow flex items-center justify-center text-2xl font-bold">M</div>
        <div>
          <div class="text-sm text-gray-500">Motioncraft</div>
          <div class="text-xl font-semibold">Owner Dashboard</div>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <div class="text-sm text-gray-600">Demo: <span class="font-medium">${USE_DEMO ? 'ON' : 'OFF'}</span></div>
        <div class="glass-card p-2 rounded-lg"> <button class="btn" onclick="location.reload()">Refresh</button></div>
      </div>
    </header>

    <!-- Summary -->
    <section id="summary-cards" class="mb-6"></section>

    <div class="grid md:grid-cols-3 gap-4">
      <!-- Left: Orders -->
      <div class="md:col-span-2 space-y-4">
        <div class="glass-card p-4">
          <div class="flex items-center justify-between mb-3">
            <div class="font-semibold">Orders</div>
            <div class="flex gap-2">
              <button class="btn bg-white border" onclick="alert('Add order flow not implemented in demo')">+ Add Order</button>
            </div>
          </div>

          <div class="overflow-x-auto">
            <table class="w-full text-left">
              <thead class="text-sm text-gray-500">
                <tr>
                  <th class="py-2 px-2">Order</th>
                  <th class="py-2 px-2">Client</th>
                  <th class="py-2 px-2">Project</th>
                  <th class="py-2 px-2">Editor</th>
                  <th class="py-2 px-2">Status</th>
                  <th class="py-2 px-2">Price</th>
                  <th class="py-2 px-2">Paid</th>
                  <th class="py-2 px-2">Actions</th>
                </tr>
              </thead>
              <tbody id="orders-table-body" class="text-sm"></tbody>
            </table>
          </div>
        </div>

        <!-- Clients -->
        <div class="glass-card p-4">
          <div class="font-semibold mb-3">Clients</div>
          <div id="clients-list" class="grid gap-3"></div>
        </div>
      </div>

      <!-- Right: Team + Income -->
      <aside class="space-y-4">
        <div class="glass-card p-4">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Team</div>
            <div class="text-sm text-gray-500">Overview</div>
          </div>
          <div id="team-grid" class="mt-3 grid gap-3"></div>
        </div>

        <div class="glass-card p-4">
          <div class="flex items-center justify-between">
            <div class="font-semibold">Income (Dopamine Chart)</div>
            <div class="text-sm text-gray-500">${selectedMonth}</div>
          </div>
          <div class="mt-3 flex items-center gap-4">
            <canvas id="incomeChart" width="180" height="180"></canvas>
            <div id="income-numbers"></div>
          </div>
        </div>
      </aside>
    </div>

    <!-- Loader -->
    <div id="loader" style="display:none" class="fixed inset-0 bg-black/10 backdrop-blur z-50 flex items-center justify-center">
      <div class="glass-card p-4 flex items-center gap-3">
        <div class="loader w-8 h-8 border-4 border-t-transparent rounded-full animate-spin"></div>
        <div>Loading...</div>
      </div>
    </div>

    <!-- Detail Modal -->
    <div id="detail-modal" class="fixed inset-0 bg-black/30 hidden items-center justify-center z-50 p-4">
      <div class="w-full max-w-2xl glass-card p-6 relative">
        <button onclick="closeModal()" class="absolute right-4 top-4 text-gray-600">✕</button>
        <div class="text-lg font-semibold mb-3">Order Detail — <span id="detail-order-no"></span></div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <input id="detail-client-name" class="p-2 rounded border" placeholder="Client name"/>
          <input id="detail-project-title" class="p-2 rounded border" placeholder="Project title"/>
          <input id="detail-price" class="p-2 rounded border" placeholder="Price"/>
          <select id="detail-status" class="p-2 rounded border">
            <option value="fresh">Fresh</option>
            <option value="scripting">Scripting</option>
            <option value="editing">Editing</option>
            <option value="correction">Correction</option>
            <option value="final_delivery">Final Delivery</option>
            <option value="completed">Completed</option>
          </select>
          <select id="detail-assigned" class="p-2 rounded border">
            <option>Siam</option><option>Mojid</option><option>Samiul</option><option>Hojayfa</option>
          </select>
          <label class="flex items-center gap-2"><input id="detail-paid" type="checkbox"/> Paid</label>
          <textarea id="detail-notes" class="p-2 rounded border col-span-2" placeholder="Notes"></textarea>
          <textarea id="detail-internal" class="p-2 rounded border col-span-2" placeholder="Internal comments"></textarea>
        </div>
        <div class="mt-4 text-right">
          <button id="detail-save-btn" class="btn bg-indigo-600 text-white px-4 py-2 rounded">Save</button>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mt-8 text-sm text-gray-500">
      Built for Motioncraft — demo mode: <strong>${USE_DEMO ? 'ON' : 'OFF'}</strong>. Replace APPS_SCRIPT_BASE_URL in the top of the file with your Apps Script Web App URL to connect real Google Sheet data.
    </footer>
  </div>

</body>
</html>
